!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var s in r)("object"==typeof exports?exports:t)[s]=r[s]}}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function r(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(s,o,function(e){return t[e]}.bind(null,o));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PROTO_VERSION="1.0.0",e.ROOMVERSION="V1",function(t){t[t.debug=0]="debug",t[t.info=1]="info",t[t.warn=2]="warn",t[t.error=3]="error",t[t.report=99]="report",t[t.disable=100]="disable"}(e.ENUM_LOG_LEVEL||(e.ENUM_LOG_LEVEL={})),function(t){t[t.disable=0]="disable",t[t.websocket=1]="websocket",t[t.https=2]="https"}(e.ENUM_REMOTE_TYPE||(e.ENUM_REMOTE_TYPE={}));var s=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this._id=null,this.next=null,this.prev=null,this._id=t,this._data=e}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),t.prototype.hasNext=function(){return this.next&&this.next.id},t.prototype.hasPrev=function(){return this.prev&&this.prev.id},t}();e.ListNode=s;var o=function(){function t(){this.start=new s,this.end=new s,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return t.prototype.insertBefore=function(t,e){var r=new s(this._idCounter,e);return r.next=t,r.prev=t.prev,t.prev.next=r,t.prev=r,++this._idCounter,++this._numNodes,r},t.prototype.addLast=function(t){return this.insertBefore(this.end,t)},t.prototype.add=function(t){return this.addLast(t)},t.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},t.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},t.prototype.size=function(){return this._numNodes},t.prototype.getFromFirst=function(t){var e=0,r=this.start.next;if(t>=0)for(;e<t&&null!==r;)r=r.next,++e;else r=null;if(null===r)throw"Index out of bounds.";return r},t.prototype.get=function(t){return 0===t?this.getFirst():t===this._numNodes-1?this.getLast():this.getFromFirst(t)},t.prototype.remove=function(t){return t.prev.next=t.next,t.next.prev=t.prev,--this._numNodes,t},t.prototype.removeFirst=function(){var t=null;return this._numNodes>0&&(t=this.remove(this.start.next)),t},t.prototype.removeLast=function(){var t=null;return this._numNodes>0&&(t=this.remove(this.end.prev)),t},t.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},t.prototype.each=function(t){for(var e=this.start;e.hasNext();)t(e=e.next)},t.prototype.find=function(t){for(var e=this.start,r=!1,s=null;e.hasNext()&&!r;)t(e=e.next)&&(s=e,r=!0);return s},t.prototype.map=function(t){for(var e=this.start,r=[];e.hasNext();)t(e=e.next)&&r.push(e);return r},t.prototype.push=function(t){return this.addLast(t)},t.prototype.unshift=function(t){this._numNodes>0?this.insertBefore(this.start.next,t):this.insertBefore(this.end,t)},t.prototype.pop=function(){return this.removeLast()},t.prototype.shift=function(){return this.removeFirst()},t}();e.LinkedList=o,e.sdkErrorList={SUCCESS:{code:"ZegoClient.Success",msg:"success."},PARAM:{code:"ZegoClient.Error.Param",msg:"input error."},HEARTBEAT_TIMEOUT:{code:"ZegoClient.Error.Timeout",msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:"ZegoClient.Error.Timeout",msg:"login timeout."},SEND_MSG_TIMEOUT:{code:"ZegoClient.Error.Timeout",msg:"send customsg timeout."},RESET_QUEUE:{code:"ZegoClient.Error.Timeout",msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:"ZegoClient.Error.Network",msg:"network is broken and login fail."},KICK_OUT:{code:"ZegoClient.Error.Kickout",msg:"kickout reason="},UNKNOWN:{code:"ZegoClient.Error.Unknown",msg:"unknown error."},FREQ_LIMITED:{code:"ZegoClient.Error.requencyLimited",msg:"Frequency Limited."}},function(t){t[t.disconnected=0]="disconnected",t[t.connecting=1]="connecting",t[t.connected=2]="connected"}(e.ENUM_SIGNAL_STATE||(e.ENUM_SIGNAL_STATE={})),e.ENUM_RESOLUTION_TYPE={LOW:{width:240,height:320,frameRate:15,bitRate:300},MEDIUM:{width:480,height:640,frameRate:15,bitRate:800},HIGH:{width:720,height:1280,frameRate:20,bitRate:1500}},e.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},e.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},e.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},e.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},e.MAX_TRY_CONNECT_COUNT=3,e.SEND_MSG_RESET=2,e.SEND_MSG_TIMEOUT=1,e.MAX_TRY_HEARTBEAT_COUNT=5,e.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5},e.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},e.ENUM_STREAM_UPDATE_TYPE={added:0,deleted:1},function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login"}(e.ENUM_RUN_STATE||(e.ENUM_RUN_STATE={})),e.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},e.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2},e.MAX_TRY_LOGIN_COUNT=5,e.TRY_LOGIN_INTERVAL=[2e3,2e3,3e3,3e3,4e3],e.MINIUM_HEARTBEAT_INTERVAL=3e3,e.ENUM_STREAM_UPDATE_CMD={added:12001,updated:12002,deleted:12003},e.SERVER_ERROR_CODE=1e4,e.MIXSTREAM_ERROR_CODE=1e4,function(t){t[t.low=1]="low",t[t.stantard=2]="stantard",t[t.hight=3]="hight",t[t.custome=4]="custome"}(e.QUALITYLEVEL||(e.QUALITYLEVEL={})),e.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},e.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},function(t){t[t.auto=0]="auto",t[t.ultra=1]="ultra"}(e.ENUM_PLAY_SOURCE_TYPE||(e.ENUM_PLAY_SOURCE_TYPE={})),function(t){t[t.cdn=0]="cdn",t[t.ultra=1]="ultra",t[t.customUrl=2]="customUrl"}(e.ENUM_DISPATCH_TYPE||(e.ENUM_DISPATCH_TYPE={})),function(t){t[t.ClientType_None=0]="ClientType_None",t[t.ClientType_H5=1]="ClientType_H5",t[t.ClientType_SmallPragram=2]="ClientType_SmallPragram",t[t.ClientType_Webrtc=3]="ClientType_Webrtc"}(e.E_CLIENT_TYPE||(e.E_CLIENT_TYPE={}))},function(t,e,r){"use strict";var s=this&&this.__awaiter||function(t,e,r,s){return new(r||(r=Promise))(function(o,i){function n(t){try{h(s.next(t))}catch(t){i(t)}}function a(t){try{h(s.throw(t))}catch(t){i(t)}}function h(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(n,a)}h((s=s.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var r,s,o,i,n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(o=2&i[0]?s.return:i[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,s=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(o=(o=n.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){n.label=i[1];break}if(6===i[0]&&n.label<o[1]){n.label=o[1],o=i;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(i);break}o[2]&&n.ops.pop(),n.trys.pop();continue}i=e.call(t,n)}catch(t){i=[6,t],s=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.checkConfigParam=function(t,e){return t.appid&&"number"==typeof t.appid?"string"!=typeof t.deviceId||""==t.deviceId?(e.error("ccp.0 deviceid must be string"),!1):"number"!=typeof t.anType?(e.error("ccp.0 an type must be number"),!1):"string"!=typeof t.dispatchServer||""==t.dispatchServer?(e.error("ccp.0 dispatchServer must be string and not empty"),!1):"string"==typeof t.idName&&""!=t.idName||(e.error("ccp.0 idName must be string and not empty"),!1):(e.error("ccp.0 appid must be number"),!1)},t.checkLoginParam=function(t,e){return!0},t.registerCallback=function(t,e,r){var s,o;e.success&&(s=e.success),e.error&&(o=e.error),r[t+"SuccessCallback"]=s,r[t+"ErrorCallback"]=o},t.actionErrorCallback=function(t,e){return e[t+"ErrorCallback"]},t.actionSuccessCallback=function(t,e){return e[t+"SuccessCallback"]},t.getServerError=function(t){var e={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",2002:"biz channel error",1000000000:"liveroom cmd error, result="};if(0===t)return{code:"ZegoClient.Success",msg:"success"};var r={code:"ZegoClient.Error.Server",msg:""};return r.msg=t>1e9?e[1e9]+t:e[t]?"unknown error code:"+t:e[t],r},t.isKeepTryLogin=function(t){switch(t){case 1002:case 1003:return!0;default:return!1}},t.mergeStreamList=function(t,e,r,s,o){t.debug("msl.0 call");var i,n=[],a=[],h=[];s||(s=[]);for(var l=0;l<s.length;l++)if(s[l].anchor_id_name!=e){i=!1;for(var c=0;c<r.length;c++)if(s[l].stream_id===r[c].stream_id){s[l].extra_info!==r[c].extra_info&&h.push(s[l]),i=!0;break}i||n.push(s[l])}else t.debug("msl.0 have self stream added");for(var u=0;u<r.length;u++){i=!1;for(var d=0;d<s.length;d++)if(r[u].stream_id===s[d].stream_id){i=!0;break}i||a.push(r[u])}r.splice(0);for(l=0;l<s.length;l++)r.push(s[l]);o(n,a,h),t.debug("msl.0 call success")},t.checkCustomCommandParam=function(t){return!0},t.generateRandumNumber=function(t){return parseInt(Math.random()*(t+1)+"",10)},t.uuid=function(t,e){var r,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(e=e||s.length,t)for(r=0;r<t;r++)o[r]=s[0|Math.random()*e];else{var i=void 0;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(i=0|16*Math.random(),o[r]=s[19==r?3&i|8:i])}return o.join("")},t.isSupportWebrtc=function(){var t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;return!!t&&!!e&&!!r},t.isSupportH264=function(t,e){var r=!1;new RTCPeerConnection(null).createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(function(e){if(e&&e.sdp){r=!0,clearTimeout(s);var o=e.sdp.split("\r\n").some(function(t){return t.startsWith("a=rtpmap:")&&t.indexOf("H264/")>-1});t&&t(o)}},function(t){r=!0,clearTimeout(s),e&&e(t)});var s=setTimeout(function(){0==r&&e(!1)},200)},t.supportDetection=function(t,e,r){return s(this,void 0,void 0,function(){var s,i,n;return o(this,function(o){switch(o.label){case 0:if(s={webRtc:!1,capture:!1,videoDecodeType:{H264:!1,VP8:!1},screenSharing:t},(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)&&(s.webRtc=!0),!navigator)return[3,4];if(!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia))return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({video:!0,audio:!0})];case 2:return(i=o.sent())instanceof MediaStream&&0!==i.getTracks().length&&(s.capture=!0,i.getTracks().forEach(function(t){return t.stop()})),[3,4];case 3:return n=o.sent(),r&&r(n),[3,4];case 4:return this.supportVideoCodeType(function(t){s.videoDecodeType.H264=t.H264,s.videoDecodeType.VP8=t.VP8,e&&e(s)},function(t){r&&r(t)}),[2]}})})},t.supportVideoCodeType=function(t,e){var r=!1;new RTCPeerConnection(null).createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(function(e){if(e&&e.sdp){r=!0,clearTimeout(s);var o=e.sdp.split("\r\n"),i=o.some(function(t){return t.startsWith("a=rtpmap:")&&t.indexOf("H264/")>-1}),n=o.some(function(t){return t.startsWith("a=rtpmap:")&&t.indexOf("VP8/")>-1}),a=o.some(function(t){return t.startsWith("a=rtpmap:")&&t.indexOf("VP9/")>-1}),h=o.some(function(t){return t.startsWith("a=rtpmap:")&&t.indexOf("H264/")>-1});t&&t({H264:i,VP8:n,Vp9:a,H265:h})}},function(t){r=!0,clearTimeout(s),e&&e(t)});var s=setTimeout(function(){0==r&&e(!1)},200)},t.inlineWorker=function(t){if(Worker){var e=t.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([e],{type:"text/javascript"}));return new Worker(r)}return null},t.getBrowser=function(){var t=window.navigator.userAgent,e=null!=window.ActiveXObject&&-1!=t.indexOf("MSIE"),r=-1!=t.indexOf("Firefox"),s=null!=window.opr,o=t.indexOf("Chrome")&&window.chrome,i=-1!=t.indexOf("Safari")&&-1!=t.indexOf("Version");return e?"IE":r?"Firefox":s?"Opera":o?"Chrome":i?"Safari":"Unkown"},t.IsPC=function(){for(var t=navigator.userAgent,e=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),r=!0,s=0;s<e.length;s++)if(t.indexOf(e[s])>0){r=!1;break}return r},t.getOS=function(){var t=navigator.userAgent,e=(navigator.appVersion,t.indexOf("Android")>-1||t.indexOf("Linux")>-1),r=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return e?1:r?2:10},t}();e.ClientUtil=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this.url=t,this.protocol=e||null,this.readyState=3,this._websocket=wx.connectSocket({url:t}),this.init()}return t.prototype.init=function(){var t=this;this._websocket&&(this.readyState=0,this._websocket.onOpen(function(e){t.readyState=t._websocket.readyState,"function"==typeof t.onopen&&(t.onopen(e),t._websocket.onClose(function(e){t.readyState=t._websocket.readyState,"function"==typeof t.onclose&&t.onclose(e)}),t._websocket.onMessage(function(e){"function"==typeof t.onmessage&&t.onmessage(e)}))}),this._websocket.onError(function(e){t.readyState=t._websocket.readyState,"function"==typeof t.onerror&&t.onerror(e)}))},t.prototype.onopen=function(t){},t.prototype.onerror=function(t){},t.prototype.onclose=function(t){},t.prototype.onmessage=function(t){},t.prototype.send=function(t){this._websocket&&this._websocket.send({data:t})},t.prototype.close=function(){this._websocket&&this._websocket.close()},t}();e.ZegoWebSocket=s},function(t,e,r){"use strict";var s,o=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=r(4),n=r(8),a=r(2),h=r(0),l=r(10),c=r(18),u=function(t){function e(){var e=t.call(this)||this;return e.preferPlaySourceType=h.ENUM_PLAY_SOURCE_TYPE.ultra,e.preferPublishSourceType=h.ENUM_DISPATCH_TYPE.ultra,e.currentPlaySourceType=h.ENUM_DISPATCH_TYPE.cdn,e.mixStreamList={},e.ultraPlaySourceType="rtmp_v2",e.logger=new n.LoggerWechat,e.stateCenter=new c.StateCenter,e.streamCenter=new i.ZegoStreamCenterWechat(e.logger,e.stateCenter),e.init(),e}return o(e,t),e.prototype.getSocket=function(t){return new a.ZegoWebSocket(t)},e.prototype.setPreferPlaySourceType=function(t){return this.logger.debug("zc.p.sppst.0 call"),"number"!=typeof t||t!==h.ENUM_PLAY_SOURCE_TYPE.auto&&t!==h.ENUM_PLAY_SOURCE_TYPE.ultra?(this.logger.info("zc.p.sppst.0 param error"),!1):(this.preferPlaySourceType=t,this.logger.debug("zc.p.sppst.0 call success"),!0)},e.prototype.setPreferPublishSourceType=function(t,e){return this.logger.debug("zc.p.sppst.1 call"),"number"!=typeof t||t!==h.ENUM_DISPATCH_TYPE.cdn&&t!==h.ENUM_DISPATCH_TYPE.ultra&&t!==h.ENUM_DISPATCH_TYPE.customUrl?(this.logger.error("zc.p.sppst.1 param error"),!1):t!==h.ENUM_DISPATCH_TYPE.customUrl||e?(this.preferPublishSourceType=t,this.customCdnUrl=e,this.logger.debug("zc.p.sppst.1 call success"),!0):(this.logger.error("zc.p.sppst.1 param error"),!1)},e.prototype.startPlayingStream=function(t,e){return this.logger.debug("zc.p.sps.0 call"),t&&""!==t?this.stateCenter.isLogin()?(this.streamCenter.updatePlayingState(t,e,!0),this.streamCenter.isPublishing()?this.preferPublishSourceType==h.ENUM_DISPATCH_TYPE.cdn?this.startPlayingStreamFromCDN(t):this.startPlayingStreamFromBGP(t):this.preferPlaySourceType==h.ENUM_PLAY_SOURCE_TYPE.ultra?this.startPlayingStreamFromBGP(t):this.startPlayingStreamFromCDN(t)):(this.logger.info("zc.p.sps.0 not login"),!1):(this.logger.info("zc.p.sps.0 param error"),!1)},e.prototype.stopPlayingStream=function(t){if(this.logger.debug("zc.p.sps.1.0 call"),!t||""===t)return this.logger.info("zc.p.sps.1.0 param error"),!1;for(var e in this.streamCenter.stopPlayingStream(t),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[e]===t){delete this.stateCenter.streamUrlMap[e];break}return this.logger.debug("zc.p.sps.1.0 call success"),!0},e.prototype.startPublishingStream=function(t,e,r){if(void 0===e&&(e=""),void 0===r&&(r=""),this.logger.debug("zc.p.sps.1 call"),"string"!=typeof t||""==t)return this.logger.error("zc.p.sps.1 streamID must be string and not empty"),!1;if(!this.stateCenter.isLogin())return this.logger.error("zc.p.sps.1 not login"),!1;if(this.stateCenter.publishStreamList[t]={state:h.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:r},this.logger.info("zc.p.sps.0 fetch stream url"),this.streamCenter.updatePublishingState(t,e,!0),this.fetchPublishStreamUrl(t),this.streamCenter.isPlaying()&&this.preferPublishSourceType==h.ENUM_DISPATCH_TYPE.ultra&&this.currentPlaySourceType==h.ENUM_DISPATCH_TYPE.cdn)for(var s=0;s<this.streamCenter.playingList.length;s++){var o=this.streamCenter.playingList[s].streamid,i=this.streamCenter.playingList[s].params;this.stopPlayingStream(o),this.streamCenter.updatePlayingState(o,i,!0),this.startPlayingStreamFromBGP(o)}return!0},e.prototype.stopPublishingStream=function(t){return this.logger.debug("zc.p.sps.1.1 call"),t&&""!==t?(this.streamCenter.stopPublishingStream(t),this.stateCenter.publishStreamList[t]&&(this.stateCenter.publishStreamList[t].state>=h.ENUM_PUBLISH_STREAM_STATE.update_info&&this.streamHandler.updateStreamDeleted(t),delete this.stateCenter.publishStreamList[t]),this.stateCenter.streamUrlMap[t]&&delete this.stateCenter.streamUrlMap[t],this.logger.debug("zc.p.sps.1.1 call success"),!0):(this.logger.info("zc.p.sps.1.1 streamid must be string and not empty"),!1)},e.prototype.updatePlayerState=function(t,e){this.logger.debug("zc.p.upe.0 call"),this.streamCenter.updatePlayerState(t,e)},e.prototype.updatePlayerNetStatus=function(t,e){this.logger.debug("zc.p.upns.0 call"),this.streamCenter.updatePlayerNetStatus(t,e)},e.prototype.startPlayingMixStream=function(t,e){return this.logger.debug("zc.p.spms.0 call"),t&&""!==t?this.stateCenter.isLogin()?(this.streamCenter.updatePlayingState(t,e,!0),this.mixStreamList[t]={urltra_url_rtmp:null},this.fetchPlayStreamUrl(t,"rtmp_cdn"),this.logger.debug("zc.p.spms.0 call success"),!0):(this.logger.info("zc.p.spms.0 not login"),!1):(this.logger.info("zc.p.spms.0 param error"),!1)},e.prototype.stopPlayingMixStream=function(t){if(this.logger.debug("zc.p.spms.1 call"),!t||""===t)return this.logger.info("zc.p.spms.1 param error"),!1;for(var e in this.streamCenter.stopPlayingStream(t),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[e]===t){delete this.stateCenter.streamUrlMap[e];break}return delete this.mixStreamList[t],this.logger.debug("zc.p.spms.1 call success"),!0},e.prototype.startPlayingStreamFromCDN=function(t){this.logger.debug("zc.p.spsfc.0 call");for(var e=null,r=0;r<this.stateCenter.streamList.length;r++)if(this.stateCenter.streamList[r].stream_id===t){e=this.stateCenter.streamList[r].urls_rtmp||[];break}return!e||e.length<=0?(this.logger.error("zc.p.spsfc.0 cannot find stream url,Please check if CDN is configured "),!1):(this.currentPlaySourceType=h.ENUM_DISPATCH_TYPE.cdn,this.logger.debug("zc.p.spsfc.0 play stream"),this.doPlayStream(t,e,this.currentPlaySourceType))},e.prototype.startPlayingStreamFromBGP=function(t){return this.currentPlaySourceType=h.ENUM_DISPATCH_TYPE.ultra,this.logger.info("zc.p.sps.0 fetch stream url"),this.fetchPlayStreamUrl(t,this.ultraPlaySourceType),!0},e.prototype.fetchPublishStreamUrl=function(t){var e=this;if(this.logger.debug("fpsu.0 call"),this.stateCenter.runState===h.ENUM_RUN_STATE.login){this.logger.info("fpsu.0 send fetch publish request");var r={stream_id:t,dispatch_type:1,stream_type:2,an_type:this.stateCenter.anType};this.socketCenter.registerRouter("zegochat_js.stream_dispatch_rsp",function(t){e.handleFetchStreamUrlRsp(t)});var s=this.socketCenter.sendMessage("zegochat_js.stream_dispatch_req",r);-1==s?(this.onPublishStateUpdate(1,t,-1),this.streamCenter.stopPublishingStream(t)):(this.stateCenter.streamUrlMap[s]=t,this.stateCenter.publishSeq.push(s)),this.logger.debug("fpsu.0 call success")}else this.logger.error("fpsu.0 state error")},e.prototype.fetchPlayStreamUrl=function(t,e){var r=this;if(this.logger.debug("fsu.0 call"),this.stateCenter.isLogin()){this.logger.info("fsu.0 send fetch request");var s={stream_id:t,dispatch_type:2,stream_type:2,an_type:this.stateCenter.anType};this.socketCenter.registerRouter("zegochat_js.stream_dispatch_rsp",function(t){r.handleFetchStreamUrlRsp(t)});var o=this.socketCenter.sendMessage("zegochat_js.stream_dispatch_req",s,void 0,function(t,e){r.stateCenter.streamUrlMap[e]?r.onPlayStateUpdate(1,r.stateCenter.streamUrlMap[e],-1):r.logger.info("fsu.0 already stop play")});-1==o?this.onPlayStateUpdate(1,t,-1):(this.stateCenter.streamUrlMap[o]=t,this.stateCenter.playSeq.push(o)),this.logger.debug("fsu.0 call success")}else this.logger.info("fsu.0 state error")},e.prototype.updateStreamInfo=function(t,e,r,s){this.logger.debug("usi.0 call");var o="";null!=r&&"string"==typeof r&&(o=r);var i={stream_id:t,extra_info:o},n={sub_cmd:e,stream_msg:JSON.stringify(i)};this.socketCenter.registerRouter("stream",function(t){}),this.socketCenter.sendMessage("stream",n,void 0,s),this.logger.debug("usi.0 call success cmd "+e)},e.prototype.handleStreamUpdateRsp=function(t){if(this.stateCenter.isLogin())if(0==t.body.code){this.logger.debug("hsur.0 stream seq "+this.stateCenter.streamSeq+" server seq "+t.body.stream_seq),this.stateCenter.streamSeq=t.body.stream_seq;for(var e=0;e<t.body.stream_info.length;e++){var r=t.body.stream_info[e].stream_id;if(!this.stateCenter.publishStreamList[r])return void this.logger.info("hsur.0 stream is not exist");this.stateCenter.publishStreamList[r].state==h.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[r].state=h.ENUM_PUBLISH_STREAM_STATE.publishing,this.onPublishStateUpdate(0,r,0))}}else this.logger.info("hsur.0 stream update error "+t.body.code);else this.logger.info("hsur.0 not login")},e.prototype.doPlayStream=function(t,e,r){return this.logger.debug("zc.p.dps.0 call"),!(!e||e.length<=0)&&(this.streamCenter.startPlayingStream(t,e,r),!0)},e.prototype.handleFetchStreamUrlRsp=function(t){this.stateCenter.publishSeq.includes(t.header.seq)?this.handleFetchStreamPublishUrlRsp(t):this.stateCenter.playSeq.includes(t.header.seq)&&this.handleFetchStreamPlayUrlRsp(t)},e.prototype.handleFetchStreamPublishUrlRsp=function(t){this.logger.debug("hfspur.0 call");var e=this.stateCenter.streamUrlMap[t.header.seq];if(e&&delete this.stateCenter.streamUrlMap[t.header.seq],t.body.code&&0!==t.body.code)return this.logger.info("hfspur.0 server error=",t.body.code),void(this.stateCenter.publishStreamList[e]&&(this.onPublishStateUpdate(1,e,t.body.code+h.SERVER_ERROR_CODE),this.streamCenter.stopPublishingStream(e)));if(t.body.stream_url_info){var r=t.body.stream_id,s=[],o=t.body.stream_url_info.stream_url,i=t.body.stream_url_info.ip_infos,n=/^rtmp:\/\/(.*?)\/.*({.*})/;if(i.forEach(function(t){var e=t.ip_address+":"+t.port,i=o.replace(n.exec(o)[1],e);i=i.replace(n.exec(o)[2],r),s.push(i)}),!this.stateCenter.publishStreamList[r])return void this.logger.error("hfspur.0 cannot find stream");this.stateCenter.publishStreamList[r].url_rtmp=s,this.stateCenter.publishStreamList[r].state=h.ENUM_PUBLISH_STREAM_STATE.tryPublish,this.doPublishStream(r,s)}},e.prototype.handleFetchStreamPlayUrlRsp=function(t){this.logger.debug("hfsur.0 call");var e=this.stateCenter.streamUrlMap[t.header.seq];if(e&&delete this.stateCenter.streamUrlMap[t.header.seq],0!==t.body.code)return this.logger.debug("hfsur.0 server error=",t.body.code),void this.onPlayStateUpdate(1,e,t.body.code+h.SERVER_ERROR_CODE);if(t.body.stream_url_info&&t.body.stream_url_info.ip_infos.length>0){var r=t.body.stream_id,s=[],o=t.body.stream_url_info.stream_url,i=t.body.stream_url_info.ip_infos,n=/^rtmp:\/\/(.*?)\/.*({.*})/;i.forEach(function(t){var e=t.ip_address+":"+t.port,i=o.replace(n.exec(o)[1],e);i=i.replace(n.exec(o)[2],r),s.push(i)});for(var a=this.currentPlaySourceType,l=!1,c=0;c<this.stateCenter.streamList.length;c++)if(this.stateCenter.streamList[c].stream_id==r){this.stateCenter.streamList[c].urltra_url_rtmp=s,l=!0;break}!l&&this.mixStreamList[r]&&(this.mixStreamList[r].urltra_url_rtmp=s,a=h.ENUM_DISPATCH_TYPE.cdn,l=!0),l||(this.logger.info("hfsur.0 cannot find streaminfo in existing stream list"),this.stateCenter.streamList.push({stream_id:r,urltra_url_rtmp:s})),this.doPlayStream(r,s,a)}this.logger.debug("hfsur.0 call success")},e.prototype.doPublishStream=function(t,e){return this.logger.debug("zc.p.dps.1 call"),!(!e||e.length<=0)&&(this.logger.info("zc.p.dps.1 streamid: "+t+"streamUrl: "+e),this.streamCenter.startPublishingStream(t,e,this.preferPublishSourceType),this.logger.debug("zc.p.dps.1 call success"),!0)},e.prototype.setCDNInfo=function(t,e){},e.prototype.loginBodyData=function(){return{room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid||"0",room_user_session_id:this.stateCenter.roomSessionId||"0"},room_name:"",role:this.stateCenter.role,room_flag:this.stateCenter.roomFlag}},e.prototype.loginHallBodyData=function(){return{user_id:this.stateCenter.idName,device_id:this.stateCenter.deviceId,session_expire:this.stateCenter.sessionExpire,user_name:this.stateCenter.nickName,device_type:this.stateCenter.deviceType,net_type:this.stateCenter.netType,token:this.stateCenter.token}},e.prototype.dispatchBodyData=function(){return{seq:1,timestamp:(new Date).getTime,app_id:this.stateCenter.appid,user_id:this.stateCenter.idName,user_name:this.stateCenter.nickName,net_type:this.stateCenter.netType,device_id:this.stateCenter.deviceId,login_token:this.stateCenter.token,an_type:this.stateCenter.anType}},e.prototype.queueCmdHandler=function(t,e,r,s){var o=this;e&&"string"==typeof e?this.stateCenter.hallState===h.ENUM_RUN_STATE.login?(this.socketCenter.registerRouter(e,function(t){if(t.body.code&&0!==t.body.code)return o.logger.error("zc.qh.0 server error=",t.body.code),void s(t);s(t),o.logger.info("zc.qh.0 call success.")}),t&&r&&"string"==typeof t&&0!==t.length&&this.socketCenter.sendMessage(t,r)):this.logger.error("zc.qh.0 hallState is not login"):this.logger.error("zc.qh.0 rspCmd error")},e.prototype.getQueueSimpleList=function(t){var e=this;this.queueCmdHandler("zegochat_js.queue_list_req","zegochat_js.queue_list_rsp",{},function(r){r.body.code&&0!==r.body.code?(e.logger.error("zc.gqs.0 get list error, code = "+r.body.code),t(r.body.message,null)):t("",r.body.queues)})},e.prototype.WebrtcOnPublishStateUpdateHandle=function(t,e,r){},e}(l.BaseCenter);e.ZegoClient=u},function(t,e,r){"use strict";var s,o=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=r(5),n=r(6),a=r(7),h=0,l=1,c=2,u=0,d=1,p=function(t){function e(e,r){var s=t.call(this,e,r)||this;return s.playerList={},s.playerCount=0,s.playingList=[],s.publishingList=[],s.eventSeq=0,s.streamEventMap={},s.playerWaitingList=[],s.playerStatistics={},s.logger=e,s.dataReport=new n.ZegoDataReport(s.logger),s}return o(e,t),e.prototype.updatePlayingState=function(t,e,r){null!=t&&(this.updateStreamState(t,r,e,this.playingList),r?(this.eventSeq+=1,this.streamEventMap[t]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPlayInfo")):this.reportPlayEvent(t))},e.prototype.updatePublishingState=function(t,e,r){void 0===e&&(e=""),void 0===r&&(r=!1),null!=t&&(this.updateStreamState(t,r,e,this.publishingList),r?(this.eventSeq+=1,this.streamEventMap[t]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPublishInfo")):this.reportPublishEvent(t))},e.prototype.updateStreamState=function(t,e,r,s){if(t)if(r&&"string"==typeof r||(r=""),1==e)s.push({streamid:t,params:r});else for(var o=0;o<s.length;o++)if(s[o].streamid==t){s.splice(o,1);break}},e.prototype.isPlaying=function(){return 0!=this.playingList.length},e.prototype.isPublishing=function(){return 0!=this.publishingList.length},e.prototype.startPlayingStream=function(t,e,r){this.logger.debug("zpc.sps.0 call");var s=this.streamEventMap[t];if(s){var o="";0==r?o="cdn":1==r&&(o="ultra_src"),this.dataReport.eventEndWithMsg(s,"GotPlayInfo",{type:o,urls:e})}return this.startPlayer(t,e,r,u)},e.prototype.startPlayer=function(t,e,r,s){var o=this.playerList[t];if(o)return!0;var i=[];s==u?i=this.playingList:s==d&&(i=this.publishingList);for(var n=!1,h="",l=0;l<i.length;l++)if(i[l].streamid==t){n=!0,h=i[l].params;break}if(!n)return this.logger.warn("zpc.sp.0 should not start"),!1;if((o=this.playerList[t]=new a.ZegoPlayWechat(this.logger,t,e,h,this.getReconnectLimit(r),this,r,s,this.dataReport)).playerSeq=this.streamEventMap[t],!o)return this.logger.info("zpc.sp.0 new player failed"),!1;++this.playerCount;var c=o.tryStartPlayer(0);return this.logger.debug("zpc.sp.0 call result:",c),c},e.prototype.stopPlayingStream=function(t){this.logger.debug("zpc.sps.1.0 call"),null!=t&&(this.stopPlayer(t),this.updatePlayingState(t))},e.prototype.stopPlayer=function(t){var e=this.playerList[t];e&&(e.stopPlayer(),delete this.playerList[t],--this.playerCount),this.logger.debug("zpc.sp.1.0 call success")},e.prototype.startPublishingStream=function(t,e,r){this.logger.debug("zpc.sps.1 call");var s=this.streamEventMap[t];if(s){var o="";0==r?o="cdn":1==r&&(o="ultra_src"),this.dataReport.eventEndWithMsg(s,"GotPublishInfo",{type:o,urls:e})}return this.startPlayer(t,e,r,d)},e.prototype.stopPublishingStream=function(t){this.logger.debug("zpc.sps.1.1 call"),null!=t&&(this.stopPlayer(t),this.updatePublishingState(t,"",!1))},e.prototype.updatePlayerState=function(t,e){var r=this.playerList[t];r?r.updateEvent(e):this.logger.warn("zpc.upe.1.0 no player "+t),this.logger.debug("zpc.upe.1.0 updatePlayerEvent success")},e.prototype.updatePlayerNetStatus=function(t,e){var r=this.playerList[t];r?r.updatePlayerNetStatus(e):this.logger.warn("zpc.upns.1.0 no player "+t),this.logger.debug("zpc.upns.1.0 updatePlayerNetStatus success")},e.prototype.reset=function(){this.logger.debug("zpc.r.0 call");for(var t=0;t<this.playingList.length;t++)this.stopPlayingStream(this.playingList[t]);for(var e=0;e<this.publishingList.length;e++)this.stopPublishingStream(this.publishingList[e]);this.playerCount=0,this.playerList={},this.playerWaitingList=[],this.playerStatistics={},this.streamEventMap={},this.logger.debug("zpc.r.0 call success")},e.prototype.reportPublishEvent=function(t,e){if(this.streamEventMap[t]){var r=this.streamEventMap[t];this.dataReport.addMsgExt(r,{stream:t,error:e}),this.dataReport.uploadReport(r,"WXPublishStream"),delete this.streamEventMap[t]}},e.prototype.reportPlayEvent=function(t,e){if(this.streamEventMap[t]){var r=this.streamEventMap[t];this.dataReport.addMsgExt(r,{stream:t,error:e}),this.dataReport.uploadReport(r,"WXPlayStream"),delete this.streamEventMap[t]}},e.prototype.onPlayStateUpdate=function(t,e,r){},e.prototype.onPlayQualityUpdate=function(t,e){},e.prototype.onPublishStateUpdate=function(t,e,r){},e.prototype.onPublishQualityUpdate=function(t,e){},e.prototype.onPlayerStreamUrlUpdate=function(t,e,r){},e.prototype.onVideoSizeChanged=function(t){},e.prototype.getReconnectLimit=function(t){return 1},e.prototype.onPlayerStart=function(t,e){this.logger.debug("ops.0 call"),e==u?this.onPlayStateUpdate(h,t,0):e==d&&this.onPublishStateUpdate(h,t,0)},e.prototype.onPlayerStop=function(t,e,r){this.logger.debug("ops.1 call"),e==u?(this.reportPlayEvent(t,r),this.logger.warn("ops.1 play error"),this.onPlayStateUpdate(l,t,r)):e==d&&(this.reportPublishEvent(t,r),this.logger.warn("ops.1 publish error"),this.onPublishStateUpdate(l,t,r))},e.prototype.onPlayerRetry=function(t,e){this.logger.debug("opr.0 call"),e==u?this.onPlayStateUpdate(c,t,0):e==d&&this.onPublishStateUpdate(c,t,0)},e.prototype.onPlayerQuality=function(t,e,r){r==u?this.onPlayQualityUpdate(t,e):r==d&&this.onPublishQualityUpdate(t,e)},e.prototype.onStreamUrlUpdate=function(t,e,r){this.logger.debug("opuu.0 call"),this.onPlayerStreamUrlUpdate(t,e,r)},e.prototype.onPlayerVideoSizeChanged=function(t){this.onVideoSizeChanged(t)},e}(i.ZegoStreamCenter);e.ZegoStreamCenterWechat=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this.playerList={},this.publisherList={}}return t.prototype.setSessionInfo=function(t,e,r,s){},t}();e.ZegoStreamCenter=s},function(t,e,r){"use strict";var s=this&&this.__assign||Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this.log=t,this.dataStatistics={},this.logger=t}return t.prototype.newReport=function(t){this.dataStatistics[t]={abs_time:Date.now(),time_consumed:0,error:0,events:[]}},t.prototype.addMsgExt=function(t,e){this.dataStatistics[t]?this.dataStatistics[t].msg_ext=e:console.warn(t+" not exist")},t.prototype.eventStart=function(t,e){this.dataStatistics[t]?null!=this.dataStatistics[t].events?this.dataStatistics[t].events.push({event:e,abs_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},t.prototype.eventEnd=function(t,e,r){if(this.dataStatistics[t]){var s=this.dataStatistics[t].events;if(s&&0!==s.length){for(var o=s.length-1;o>=0;o--)if(s[o].event==e&&s[o].time_consumed){s[o].time_consumed=Date.now()-s[o].abs_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},t.prototype.eventEndWithMsg=function(t,e,r){if(this.dataStatistics[t]){var o=this.dataStatistics[t].events;if(o){for(var i=o.length-1;i>=0;i--)if(o[i].event==e&&o[i].time_consumed){o[i].time_consumed=Date.now()-o[i].abs_time,null==o[i].msg_ext&&(o[i].msg_ext={}),o[i].msg_ext=s({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},t.prototype.addEventInfo=function(t,e,r,s){if(this.dataStatistics[t]){var o=this.dataStatistics[t].events;if(null!=o){for(var i=o.length-1;i>=0;i--)if(o[i].event==e&&null!=o[i].time_consumed&&o[i].event==e&&null!=o[i].time_consumed){null==o[i].msg_ext&&(o[i].msg_ext={}),o[i].msg_ext[r]=s;break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},t.prototype.addEvent=function(t,e,r){this.dataStatistics[t]?this.dataStatistics[t].events&&(r?this.dataStatistics[t].events.push({event:e,abs_time:Date.now(),msg_ext:r}):this.dataStatistics[t].events.push({event:e,abs_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},t.prototype.uploadReport=function(t,e){var r=this.dataStatistics[t];null!=r&&(r.itemtype=e,r.time_consumed=Date.now()-r.abs_time,this.logger.report(r),delete this.dataStatistics[t])},t}();e.ZegoDataReport=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={start:0,playing:1,stop:2},o=function(){function t(t,e,r,o,i,n,a,h,l){this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.reconnectCount=0,this.state=s.stop,this.playerSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.everSuccess=!1,this.playerLogUploadTime=(new Date).getTime(),this.streamid=e,this.urls=r,this.reconnectLimit=i,this.logger=t,this.streamCenter=n,this.sourceType=a,this.playerType=h,this.params=o,this.dataReport=l}return t.prototype.resetPlayer=function(){this.state=s.stop},t.prototype.newPlayer=function(){this.resetPlayer();var t=this.getCurrentPlayerUrl(),e=t;return 0!=this.params.length&&(e=t+"?"+this.params),t!==this.currentUrl?(this.currentUrl=t,this.streamCenter.onStreamUrlUpdate(this.streamid,e,this.playerType)):this.streamCenter.onPlayerRetry(this.streamid,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerSeq,"PlayBegin"),this.dataReport.addEventInfo(this.playerSeq,"PlayBegin","url",e)):(this.dataReport.eventStart(this.playerSeq,"PublishBegin"),this.dataReport.addEventInfo(this.playerSeq,"PublishBegin","url",e)):0==this.playerType?this.dataReport.addEventInfo(this.playerSeq,"PlayRetry","url",e):this.dataReport.addEventInfo(this.playerSeq,"PublishRetry","url",e),this.state=s.start,!0},t.prototype.stopPlayer=function(){0==this.playerType?this.dataReport.eventEndWithMsg(this.playerSeq,"PlayStat",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerSeq,"PublishStat","quality",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerSeq,"PublishStat",{quality:this.playerInfo}))},t.prototype.tryStartPlayer=function(t){for(;this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.logger.info("zp.tsp.0 index: "+this.playUrlIndex+", url: "+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.logger.info("zp.tsp.0 stream: "+this.streamid),this.resetPlayer();var e="";0==this.playerType?e="PlayEnd":1==this.playerType&&(e="PublishEnd",this.reportQualityStatics());var r={error:t,reason:"no url to retry"};this.dataReport.addEvent(this.playerSeq,e,r),this.streamCenter.onPlayerStop(this.streamid,this.playerType,t)}},t.prototype.shouldRetryPlay=function(t){var e=t.detail.code;return 3001==e||3002==e||3003==e||3005==e},t.prototype.isPlayFailed=function(t){var e=t.detail.code;return-2301==e||2101==e||2102==e},t.prototype.shouldRetryPublish=function(t){var e=t.detail.code;return 3001==e||3002==e||3003==e||3004==e||3005==e},t.prototype.isPublishFailed=function(t){var e=t.detail.code;return-1301==e||-1302==e||-1303==e||-1304==e||-1305==e||-1306==e||-1307==e||-1308==e||-1309==e||-1310==e||-1311==e},t.prototype.updateEvent=function(t){if(0==this.playerType){if(2004==t.detail.code)this.everSuccess?this.dataReport.eventEnd(this.playerSeq,"PlayRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerSeq,"PlayStat")),this.streamCenter.onPlayerStart(this.streamid,this.playerType);else if(2009==t.detail.code)this.streamCenter.onPlayerVideoSizeChanged(this.streamid);else if(this.shouldRetryPlay(t))this.dataReport.eventStart(this.playerSeq,"PlayRetry"),this.dataReport.addEventInfo(this.playerSeq,"PlayRetry","error_code",t.detail.code);else if(this.isPlayFailed(t)){this.logger.info("zp.ue.0 play error: "+this.streamid),this.resetPlayer();var e={errorCode:t.detail.code};this.dataReport.addEvent(this.playerSeq,"PlayError",e),this.streamCenter.onPlayerStop(this.streamid,this.playerType,t.detail.code)}this.everSuccess||this.dataReport.eventEnd(this.playerSeq,"PlayBegin")}else if(1==this.playerType){if(1002==t.detail.code)this.everSuccess?this.dataReport.eventEnd(this.playerSeq,"PublishRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerSeq,"PublishStat")),this.streamCenter.onPlayerStart(this.streamid,this.playerType);else if(this.shouldRetryPublish(t))this.dataReport.eventStart(this.playerSeq,"PublishRetry"),this.dataReport.addEventInfo(this.playerSeq,"PublishRetry","error_code",t.detail.code);else if(this.isPublishFailed(t)){this.logger.info("zp.ue.0 publish error: "+this.streamid),this.resetPlayer();var r={errorCode:t.detail.code};this.dataReport.addEvent(this.playerSeq,"PublishError",r),this.reportQualityStatics(),this.streamCenter.onPlayerStop(this.streamid,this.playerType,t.detail.code)}this.everSuccess||this.dataReport.eventEnd(this.playerSeq,"PublishBegin")}},t.prototype.updatePlayerNetStatus=function(t){var e={videoBitrate:t.detail.info.videoBitrate,audioBitrate:t.detail.info.audioBitrate,videoFPS:t.detail.info.videoFPS,videoHeight:t.detail.info.videoHeight,videoWidth:t.detail.info.videoWidth};if(this.playerInfo=e,1==this.playerType){var r={videoBitrate:t.detail.info.videoBitrate,audioBitrate:t.detail.info.audioBitrate,videoFPS:t.detail.info.videoFPS,videoGOP:t.detail.info.videoGOP,netSpeed:t.detail.info.netSpeed,netJitter:t.detail.info.netJitter,videoWidth:t.detail.info.videoWidth,videoHeight:t.detail.info.videoHeight};if(0==this.publishQualitySeq&&(this.publishQualitySeq=++this.streamCenter.eventSeq,this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgExt(this.publishQualitySeq,{stream:this.streamid})),this.dataReport.addEvent(this.publishQualitySeq,"PublishQuality",r),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount)(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportQualityStatics(),this.playerLogUploadTime=(new Date).getTime())}this.streamCenter.onPlayerQuality(this.streamid,e,this.playerType)},t.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},t.prototype.reportQualityStatics=function(){this.dataReport.uploadReport(this.publishQualitySeq,"WXPublishStateUpdate"),this.publishQualityCount=0,this.publishQualitySeq=0},t}();e.ZegoPlayWechat=o},function(t,e,r){"use strict";var s,o=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=r(9),n=r(2),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.openWebSocketLogServer=function(t){if(this.url!=t){if(this.url=t,this.stopWebSocketServer(),!t)return;this.websocket=new n.ZegoWebSocket(t),this.websocket.onopen=function(t){},this.websocket.onclose=function(t){},this.websocket.onmessage=function(t){},this.websocket.onerror=function(t){console.error("open log websocket error:"+t)}}},e.prototype.SendHttpsLog=function(){var t=this;if(0!=this.logCacheSend.length){var e=this.logCacheSend.join("\n");wx.request({url:this.url,data:e,method:"POST",success:function(e){if(0!=e.data.length){var r=e&&e.data&&e.data.interval;"number"==typeof r&&t.logUploadInterval!==r&&(t.timeInterval=r,t.openHttpsLogServer(t.url))}},fail:function(t){console.log("send failed "+t.statusCode)}}),this.logCacheSend=[]}},e.prototype.logReportParamList=function(t,e){var r=new Date,s=r.getFullYear()+"/";return s+=(i.D[r.getMonth()+1]||r.getMonth()+1)+"/",s+=(i.D[r.getDate()]||r.getDate())+" ",s+=(i.D[r.getHours()]||r.getHours())+":",s+=(i.D[r.getMinutes()]||r.getMinutes())+":",s+=i.D[r.getSeconds()]||r.getSeconds(),s+="."+r.getTime()%1e3,e.time=s,e.level=t,e.console="xcx",e.appid=this.appid,e.roomid=this.roomid,e.userid=this.userid,e.id_name=this.userid,e.userName=this.userName,e.sessionid=this.sessionid,e.version=this.version,[JSON.stringify(e)]},e}(i.Logger);e.LoggerWechat=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0);e.D=["00","01","02","03","04","05","06","07","08","09"];var o=function(){function t(){this.logLevel=s.ENUM_LOG_LEVEL.info,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100}return t.prototype.setLogLevel=function(t){this.logLevel<s.ENUM_LOG_LEVEL.debug||this.logLevel>s.ENUM_LOG_LEVEL.report?this.logLevel=s.ENUM_LOG_LEVEL.disable:this.logLevel=t},t.prototype.setRemoteLogLevel=function(t){this.logRemoteLevel<s.ENUM_LOG_LEVEL.debug||this.logRemoteLevel>s.ENUM_LOG_LEVEL.report?this.logRemoteLevel=s.ENUM_LOG_LEVEL.disable:this.logRemoteLevel=t},t.prototype.setSessionInfo=function(t,e,r,s,o,i,n){this.appid=t,this.deviceid=n,this.roomid=e,this.sessionid=r,this.userid=s,this.userName=o,this.version=i},t.prototype.openLogServer=function(t){try{t.startsWith("wss:")||t.startsWith("ws:")?(this.logType=s.ENUM_REMOTE_TYPE.websocket,this.openWebSocketLogServer(t)):t.startsWith("https:")?(this.logType=s.ENUM_REMOTE_TYPE.https,this.openHttpsLogServer(t)):this.logType=s.ENUM_REMOTE_TYPE.disable}catch(t){this.error(JSON.stringify(t))}},t.prototype.stopLogServer=function(){this.logType==s.ENUM_REMOTE_TYPE.websocket?this.stopWebSocketServer():this.logType==s.ENUM_REMOTE_TYPE.https&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=s.ENUM_REMOTE_TYPE.disable},t.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},t.prototype.openHttpsLogServer=function(t){var e=this;this.url=t,t&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval(function(){e.SendHttpsLog()},this.logUploadInterval)))},t.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},t.prototype.report=function(t){var e=this.logReportParamList(s.ENUM_LOG_LEVEL.report,t);this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.report&&console.debug.apply(console,e),this.RemoteLog(s.ENUM_LOG_LEVEL.report,e,!0)},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.logParamList(s.ENUM_LOG_LEVEL.debug,t.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.debug&&console.debug.apply(console,r),this.log(s.ENUM_LOG_LEVEL.debug,r)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.logParamList(s.ENUM_LOG_LEVEL.info,t.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.info&&console.info.apply(console,r),this.log(s.ENUM_LOG_LEVEL.info,r)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.logParamList(s.ENUM_LOG_LEVEL.warn,t.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.warn&&console.warn.apply(console,r),this.log(s.ENUM_LOG_LEVEL.warn,r)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.logParamList(s.ENUM_LOG_LEVEL.error,t.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=s.ENUM_LOG_LEVEL.error&&console.error.apply(console,r),this.log(s.ENUM_LOG_LEVEL.error,r)},t.prototype.log=function(t,e){this.logRemoteLevel!==s.ENUM_LOG_LEVEL.disable&&this.logRemoteLevel<=t&&this.RemoteLog(t,e)},t.prototype.RemoteLog=function(t,e,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==s.ENUM_REMOTE_TYPE.websocket)this.RemoteWebSocketLog(t,e);else if(this.logType==s.ENUM_REMOTE_TYPE.https)this.RemoteHttpsLog(t,e,r);else if(this.logLevel!==s.ENUM_LOG_LEVEL.disable&&this.logLevel<=t)for(this.logCacheSend.push(e);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},t.prototype.RemoteWebSocketLog=function(t,e){if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.openLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(e)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(e);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var s="",o=0;o<this.logCacheSend.length;o++)(s+this.logCacheSend[o]).length>4e3&&(this.websocket.send(s),s=""),s=s+this.logCacheSend[o]+"\n";e=s+e,this.logCacheSend=[],this.websocket.send(e)}else this.websocket.send(e);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(e)},t.prototype.RemoteHttpsLog=function(t,e,r){this.logCacheSend.push(e),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},t.prototype.logParamList=function(t,r){var s=new Date,o=s.getFullYear()+"/";o+=(e.D[s.getMonth()+1]||s.getMonth()+1)+"/",o+=(e.D[s.getDate()]||s.getDate())+" ",o+=(e.D[s.getHours()]||s.getHours())+":",o+=(e.D[s.getMinutes()]||s.getMinutes())+":",o+=e.D[s.getSeconds()]||s.getSeconds(),o+="."+s.getTime()%1e3;var i=r.substr(0,r.indexOf(" "));0==i.length&&(i=r);var n=r.substr(r.indexOf(" ")+1,4500);0==n.length&&(n="");var a={time:o,level:t,action:i,content:n,appid:this.appid,deviceid:this.deviceid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return[JSON.stringify(a)]},t}();e.Logger=o},function(t,e,r){"use strict";var s,o=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=r(11),n=r(0),a=r(1),h=r(12),l=r(13),c=r(14),u=r(15),d=r(16),p=r(17),g=function(t){function e(){return t.call(this)||this}return o(e,t),e.prototype.init=function(){this.bindSocketHandler(),this.bindStreamHandler(),this.bindHeatBeatHandler(),this.bindHallHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindStreamCenterHandler()},e.prototype.bindSocketHandler=function(){var t=this;this.socketCenter=new h.SocketCenter(this.logger,this.stateCenter),this.socketCenter.getSocket=function(e){return t.getSocket(e)},this.socketCenter.handleHallKickout=function(e){t.logger.info("zb.cm.bsh.0 call hhk"),t.hallHandler.setHallState(n.ENUM_RUN_STATE.logout),t.hallHandler.resetHall(),t.onKickOut({code:n.sdkErrorList.KICK_OUT.code,msg:n.sdkErrorList.KICK_OUT.msg+e.body.reason}),t.logger.debug("zb.cm.bsh.0 call hhk success")},this.socketCenter.handlePushKickout=function(e){t.logger.info("zb.cm.bsh.0  call hpk"),t.roomHandler.setRunState(n.ENUM_RUN_STATE.logout),t.roomHandler.resetRoom(),t.onKickOut({code:n.sdkErrorList.KICK_OUT.code,msg:n.sdkErrorList.KICK_OUT.msg+e.body.reason}),t.logger.debug("zb.cm.bsh.0  call hpk success")},this.socketCenter.handlePushCustomMsg=function(e){t.messageHandler.handlePushCustomMsg(e)},this.socketCenter.handlePushRoomMsg=function(e){t.onRecvRoomMsg(e.body.msg_data,e.body.server_msg_id,e.body.ret_msg_id)},this.socketCenter.handlePushUserStateUpdateMsg=function(e){t.roomHandler.handlePushUserStateUpdateMsg(e)}},e.prototype.bindStreamHandler=function(){var t=this;this.streamHandler=new c.StreamHandler(this.logger,this.stateCenter,this.socketCenter),this.streamHandler.onStreamUpdated=function(e,r){t.onStreamUpdated(e,r),t.onStreamUpdatedCustomer(e,r)},this.streamHandler.onPublishStateUpdate=function(e,r,s){t.onPublishStateUpdate(e,r,s)},this.streamHandler.onStreamExtraInfoUpdated=function(e){t.onStreamExtraInfoUpdated(e)}},e.prototype.bindHeatBeatHandler=function(){var t=this;this.heartBeatHandler=new u.HeartBeatHandler(this.logger,this.stateCenter,this.socketCenter),this.heartBeatHandler.hbLogout=function(e){t.onDisconnect(e)}},e.prototype.bindRoomHandler=function(){var t=this;this.roomHandler=new l.RoomHandler(this.logger,this.stateCenter,this.socketCenter),this.roomHandler.loginSuccessCallBack=function(e,r){t.streamCenter.setSessionInfo(t.stateCenter.appid,t.stateCenter.idName,t.stateCenter.token,t.stateCenter.testEnvironment),t.logger.info("zb.cm.brh hls userStateUpdate "+t.stateCenter.userStateUpdate),t.stateCenter.userStateUpdate&&(t.logger.info("zb.cm.brh hls fetch all new userlist"),t.roomHandler.fetchUserList()),t.streamHandler.handleStreamStart(e,r)},this.roomHandler.onGetTotalUserList=function(e,r){t.onGetTotalUserList(e,r)},this.roomHandler.resetRoomCallBack=function(){t.resetStreamCenter()},this.roomHandler.onUserStateUpdate=function(e,r){t.onUserStateUpdate(e,r)},this.roomHandler.onDisconnect=function(e){t.onDisconnect(e)},this.roomHandler.loginBodyData=function(){return t.loginBodyData()}},e.prototype.bindHallHandler=function(){var t=this;this.hallHandler=new p.HallHandler(this.logger,this.stateCenter,this.socketCenter),this.hallHandler.loginSuccessCallBack=function(e,r){var s=r.body.hb_interval<n.MINIUM_HEARTBEAT_INTERVAL?n.MINIUM_HEARTBEAT_INTERVAL:r.body.hb_interval;t.heartBeatHandler.start(s)},this.hallHandler.resetHallCallBack=function(){t.heartBeatHandler.resetHeartbeat()},this.hallHandler.onDisconnect=function(e){t.onDisconnect(e)},this.hallHandler.onTempBroken=function(){return t.onTempBroken()},this.hallHandler.onReconnect=function(){return t.onReconnect()},this.hallHandler.loginBodyData=function(){return t.loginHallBodyData()},this.hallHandler.dispatchBodyData=function(){return t.dispatchBodyData()}},e.prototype.bindMessageHandler=function(){var t=this;this.messageHandler=new d.MessageHandler(this.logger,this.stateCenter,this.socketCenter),this.messageHandler.onRecvCustomCommand=function(e,r,s){t.onRecvCustomCommand(e,r,s)}},e.prototype.bindStreamCenterHandler=function(){var t=this;this.streamCenter.onPlayStateUpdate=function(e,r,s){t.onPlayStateUpdateHandle(e,r,s)},this.streamCenter.onPlayQualityUpdate=function(e,r){t.onPlayQualityUpdate(e,r)},this.streamCenter.onPublishStateUpdate=function(e,r,s){t.onPublishStateUpdateHandle(e,r,s)},this.streamCenter.onPublishQualityUpdate=function(e,r){t.onPublishQualityUpdate(e,r)},this.streamCenter.onPlayerStreamUrlUpdate=function(e,r,s){t.onStreamUrlUpdate(e,r,s)},this.streamCenter.onVideoSizeChanged=function(e,r,s){t.onVideoSizeChanged(e,r,s)}},e.prototype.config=function(t){return this.logger.debug("zb.cm.cf call"),a.ClientUtil.checkConfigParam(t,this.logger)?(this.stateCenter.appid=t.appid,this.stateCenter.deviceId=t.deviceId,this.stateCenter.deviceType=t.deviceType||"",this.stateCenter.anType=t.anType,this.stateCenter.dispatchServer=t.dispatchServer,this.stateCenter.idName=t.idName,this.stateCenter.nickName=t.nickName,"boolean"==typeof t.roomFlag&&(t.roomFlag?this.stateCenter.roomFlag=1:this.stateCenter.roomFlag=0),"boolean"==typeof t.testEnvironment&&(this.stateCenter.testEnvironment=t.testEnvironment),this.logger.setLogLevel(t.logLevel),t.remoteLogLevel?this.logger.setRemoteLogLevel(t.remoteLogLevel):this.logger.setRemoteLogLevel(0),this.logger.setSessionInfo(t.appid,"","",t.idName,"",n.PROTO_VERSION,t.deviceId),t.logUrl&&this.logger.openLogServer(t.logUrl),this.stateCenter.configOK=!0,this.logger.debug("zb.cm.cf call success"),!0):(this.logger.error("zb.cm.cf param error"),!1)},e.prototype.login=function(t,e,r){t&&"string"==typeof t?this.hallHandler.login(t,e,r):this.logger.error("zb.id.lg token format error")},e.prototype.logout=function(){return this.hallHandler.logout()},e.prototype.enterRoom=function(t,e,r,s){!t||"string"!=typeof t||0!==e&&1!==e?this.logger.error("zb.id.er params error"):this.roomHandler.login(t,e,r,s)},e.prototype.leaveRoom=function(){return this.roomHandler.logout()},e.prototype.getRoomInfo=function(t){this.roomHandler.getRoomInfo(t)},e.prototype.setUserStateUpdate=function(t){"boolean"==typeof t?this.roomHandler.setUserStateUpdate(t):console.error("setUserStateUpdate param error")},e.prototype.onUserStateUpdate=function(t,e){},e.prototype.onGetTotalUserList=function(t,e){},e.prototype.release=function(){this.logger.debug("zb.cm.rl call"),this.roomHandler.setRunState(n.ENUM_RUN_STATE.logout),this.roomHandler.resetRoom(),this.logger.stopLogServer(),this.logger.debug("zb.cm.rl call success")},e.prototype.sendCustomCommand=function(t,e,r,s){return"string"!=typeof e&&"object"!=typeof e?(this.logger.error("zb.mh.scc params error"),!1):this.messageHandler.sendCustomCommand(t,e,r,s)},e.prototype.onRecvCustomCommand=function(t,e,r){},e.prototype.sendRoomMsg=function(t,e,r,s,o){this.stateCenter.runState===n.ENUM_RUN_STATE.login?this.messageHandler.sendRoomMsg(t,e,r,s,o):this.logger.error("zc.srm.0 no enter room")},e.prototype.onRecvRoomMsg=function(t,e,r){},e.prototype.getRoomChatInfo=function(t,e,r,s,o){return this.messageHandler.getRoomChatInfo(t,e,r,s,o)},e.prototype.updateStreamExtraInfo=function(t,e){return this.streamHandler.updateStreamExtraInfo(t,e)},e.prototype.onStreamUrlUpdate=function(t,e,r){},e.prototype.onStreamUpdated=function(t,e){},e.prototype.onStreamUpdatedCustomer=function(t,e){},e.prototype.onStreamExtraInfoUpdated=function(t){},e.prototype.onPlayStateUpdate=function(t,e,r){},e.prototype.onVideoSizeChanged=function(t,e,r){},e.prototype.onPlayQualityUpdate=function(t,e){},e.prototype.onPublishStateUpdate=function(t,e,r){},e.prototype.onPublishStateUpdateCustomer=function(t,e,r){},e.prototype.onPublishQualityUpdate=function(t,e){},e.prototype.onDisconnect=function(t){},e.prototype.onTempBroken=function(){},e.prototype.onReconnect=function(){},e.prototype.onKickOut=function(t){},e.getCurrentVersion=function(){return n.PROTO_VERSION},e}(i.Common);e.BaseCenter=g},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),o=function(){function t(){}return t.prototype.onPlayStateUpdateHandle=function(t,e,r){1==t&&this.stopPlayingStream(e),this.onPlayStateUpdate(t,e,r),this.onPublishStateUpdateCustomer(t,e,r)},t.prototype.onPublishStateUpdateHandle=function(t,e,r){var o=this;0==t?this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].state==s.ENUM_PUBLISH_STREAM_STATE.tryPublish?(this.stateCenter.publishStreamList[e].state=s.ENUM_PUBLISH_STREAM_STATE.update_info,this.streamHandler.updateStreamCreated(e,this.stateCenter.publishStreamList[e].extra_info,function(t){o.stateCenter.publishStreamList[e]&&o.stateCenter.publishStreamList[e].state==s.ENUM_PUBLISH_STREAM_STATE.update_info&&(o.stateCenter.publishStreamList[e].state=s.ENUM_PUBLISH_STREAM_STATE.stop,o.onPublishStateUpdate(1,e,t),o.stopPublishingStream(e))})):this.WebrtcOnPublishStateUpdateHandle(t,e,r)):(this.onPublishStateUpdate(t,e,r),1==t&&this.stopPublishingStream(e))},t.prototype.resetStreamCenter=function(){if(this.stateCenter.customUrl&&(this.stateCenter.customUrl=null),this.streamCenter.reset(),!this.socketCenter.isDisConnect())for(var t in this.stateCenter.publishStreamList)this.stateCenter.publishStreamList[t].state==s.ENUM_PUBLISH_STREAM_STATE.publishing&&this.streamHandler.updateStreamDeleted(t)},t.prototype.handleFetchWebRtcUrlRsp=function(t){if(t.body.code&&0!==t.body.code)this.logger.error("cb.cm.hfwur error "+t.body.code+" "+t.body.message);else if(t.body.stream_url_info&&0!=t.body.stream_url_info.length&&t.body.stream_url_info.ip_infos&&0!=t.body.stream_url_info.ip_infos.length){var e=t.body.stream_id,r=[],s=t.body.stream_url_info.stream_url,o=t.body.stream_url_info.ip_infos,i=/^ws(s)?:\/\/(.*?)\//;if(o.forEach(function(t){var e=t.ip_address+":"+t.port;r.push(s.replace(i.exec(s)[2],e))}),this.stateCenter.publishSeq.includes(t.header.seq))this.stateCenter.publishStreamList[e]?this.streamCenter.startPublishingStream(e,r):this.logger.error("cb.cm.hfwur no streamid to publish");else if(this.stateCenter.playSeq.includes(t.header.seq)){for(var n=!1,a=0;a<this.stateCenter.streamList.length;a++)if(this.stateCenter.streamList[a].stream_id===e){n=!0;break}0==n&&this.logger.warn("cb.cm.hfwur cannot find stream, continue to play"),this.streamCenter.startPlayingStream(e,r)}}else this.logger.error("cb.cm.hfwur no stream info")},t}();e.Common=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),o=function(){function t(t,e){var r=this;this.cmdSeq=0,this.responseRouters={},this.logger=t,this.stateCenter=e,this.responseRouters={"zegochat_js.push_user_kickout":function(t){r.handleHallKickout(t)},"zegochat_js.push_room_kickout":function(t){r.handlePushKickout(t)},"zegochat_js.push_room_custommsg_req":function(t){r.handlePushCustomMsg(t)},"zegochat_js.push_room_immsg_req":function(t){r.handlePushRoomMsg(t)},"zegochat_js.push_room_userlist_update_req":function(t){r.handlePushUserStateUpdateMsg(t)},push_merge_message:function(t){r.handlePushMergeMsg(t)},trans:function(t){r.handleTransRsp(t)},push_trans:function(t){r.handlePushTransMsg(t)}}}return t.prototype.handleHallKickout=function(t){},t.prototype.handlePushKickout=function(t){},t.prototype.handlePushCustomMsg=function(t){},t.prototype.handlePushRoomMsg=function(t){},t.prototype.handlePushUserStateUpdateMsg=function(t){},t.prototype.handlePushMergeMsg=function(t){},t.prototype.handlePushTransMsg=function(t){},t.prototype.handleBigImMsgRsp=function(t){},t.prototype.handleTransRsp=function(t){if(this.stateCenter.isLogin())if(0==t.body.code){var e=t.body.trans_type;this.stateCenter.transSeqMap[e]?(this.stateCenter.transSeqMap[e].seq=t.body.trans_seq,this.logger.debug("zb.sc.htr trans "+e+" seq "+t.body.trans_seq)):this.logger.error("zb.sc.htr cannot match send info")}else this.logger.error("zb.sc.htr trans send error "+t.body.code);else this.logger.error("zb.sc.htr not login")},t.prototype.handleBizChannelRspCallback=function(t,e){0===t.body.code?null!=e.success&&e.success(t.header.seq,t.body.cmd,t.body.rsp_body):null!=e.error&&e.error(t.body.code,t.header.seq,t.body.rsp_body)},t.prototype.registerRouter=function(t,e){this.responseRouters[t]||(this.responseRouters[t]=e)},t.prototype.getSocket=function(t){return null},t.prototype.getHeaderV2=function(t){return{Protocol:"req_v2",cmd:t,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:this.stateCenter.sessionid||"",room_id:this.stateCenter.roomid||""}},t.prototype.getHeader=function(t){return{cmd:t,seq:++this.cmdSeq,timestamp:this.stateCenter.timeStamp||Math.ceil((new Date).getTime()/1e3)+"",app_id:this.stateCenter.appid,user_uid:this.stateCenter.userid||"0",session_id:this.stateCenter.sessionid||"0"}},t.prototype.sendMessage=function(t,e,r,o){if(this.logger.debug("zb.sc.sm call "+t),this.isDisConnect())return this.logger.error("zb.sc.sm error  "+t),-1;var i="V1"===s.ROOMVERSION?this.getHeader(t):this.getHeaderV2(t),n={header:i,body:e};if(null==r&&(r=null),null==o&&(o=null),null!=r||null!=o){var a={data:n,seq:i.seq,deleted:!1,time:Date.parse(new Date+""),success:r,error:o},h=this.stateCenter.sendCommandList.push(a);this.stateCenter.sendCommandMap[a.seq]=h}return this.websocket.send(JSON.stringify(n)),this.logger.debug("zb.sc.sm success"),i.seq},t.prototype.sendCustomMessage=function(t,e,r,o){if(this.logger.debug("zb.sc.scm call"),this.isDisConnect())return this.logger.error("zb.sc.scm error"),!1;var i="V1"===s.ROOMVERSION?this.getHeader(t):this.getHeaderV2(t),n={header:i,body:e},a=JSON.stringify(n);null==r&&(r=null),null==o&&(o=null);var h={data:n,seq:i.seq,deleted:!1,time:Date.parse(new Date+""),success:r,error:o},l=this.stateCenter.sendDataList.push(h);return this.stateCenter.sendDataMap[h.seq]=l,this.websocket.send(a),this.logger.debug("zb.sc.scm success seq: ",i.seq),!0},t.prototype.isDisConnect=function(){return!this.websocket||1!==this.websocket.readyState},t.prototype.closeSocket=function(){this.websocket&&(this.logger.info("zb.sc.cs close websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},t.prototype.createSocket=function(t){this.websocket=this.getSocket(t)},t.prototype.openHandler=function(t){this.websocket.onopen=t},t.prototype.closeHandler=function(t){this.websocket.onclose=t},t.prototype.errorHandler=function(){var t=this;this.websocket.onerror=function(e){t.logger.error("zb.sc.oe msg="+JSON.stringify(e))}},t.prototype.checkResponse=function(t){var e=t.header.app_id!==this.stateCenter.appid||t.header.session_id!==this.stateCenter.sessionid||this.stateCenter.hallState!==s.ENUM_RUN_STATE.login;return e&&this.logger.error("zb.sc.crp check session fail."),e},t.prototype.responseHandler=function(){var t=this;this.websocket.onmessage=function(e){var r=JSON.parse(e.data);t.logger.info("zb.sc.ws.rph jsonmsg= ",r.header.cmd),t.logger.info("zb.sc.ws.rph jsonmsg= ",e.data),"zegochat_js.user_login_ws_rsp"!==r.header.cmd?"zegochat_js.user_logout_rsp"!==r.header.cmd?"zegochat_js.room_enter_rsp"!==r.header.cmd?"zegochat_js.room_quit_rsp"!==r.header.cmd?t.stateCenter.isLogin()?t.checkResponse(r)?t.logger.error("zb.sc.ws.rph check session fail."):(t.handleSendCommandMsgRsp(r),t.logger.info("zb.sc.ws.rph cmd="+r.header.cmd+",function="+!!t.responseRouters[r.header.cmd]),t.responseRouters[r.header.cmd]&&t.responseRouters[r.header.cmd](r)):t.logger.warn("zb.sc.ws.rph  already logout"):t.responseRouters.leaveRoom(r,t.cmdSeq):t.responseRouters.enterRoom(r,t.cmdSeq):t.responseRouters.hallLogout(r,t.cmdSeq):t.responseRouters.hallLogin(r,t.cmdSeq)}},t.prototype.handleSendCommandMsgRsp=function(t){this.logger.debug("zb.sc.hscmr call");var e,r=this.stateCenter.sendCommandMap[t.header.seq];null!=r&&("zegochat_js.user_login_ws_req"==(e=r._data).data.header.cmd?this.logger.debug("zb.sc.hscmr don't check "+e.data.header.cmd):0===t.body.code?null!=e.success&&e.success(t.header.seq):null!=e.error&&e.error(t.body.messsage,t.header.seq),delete this.stateCenter.sendCommandMap[t.header.seq],this.stateCenter.sendCommandList.remove(r)),this.logger.debug("zb.sc.hscmr call success")},t}();e.SocketCenter=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),o=r(1),i=function(){function t(t,e,r){this.logger=t,this.socketCenter=r,this.stateCenter=e}return t.prototype.setRunState=function(t){this.logger.debug("zb.rh.srs old="+this.stateCenter.runState+", new="+t),this.stateCenter.lastRunState=this.stateCenter.runState,this.stateCenter.runState=t},t.prototype.resetTryLogin=function(){this.logger.debug("zb.rh.rtl call"),clearTimeout(this.stateCenter.tryLoginTimer),this.stateCenter.tryLoginTimer=null,this.stateCenter.tryLoginCount=0,this.logger.debug("zb.rh.rtl call success")},t.prototype.resetBigRoomInfo=function(){this.stateCenter.transSeqMap={},this.stateCenter.realyMessageList=[],this.stateCenter.relayTimer&&(clearTimeout(this.stateCenter.relayTimer),this.stateCenter.relayTimer=null),this.stateCenter.bigImLastTimeIndex=0,this.stateCenter.bigIMmessageList=[],this.stateCenter.bigImCallbackMap={},this.stateCenter.bigImTimer&&(clearTimeout(this.stateCenter.bigImTimer),this.stateCenter.bigImTimer=null),this.stateCenter.serverTimeOffset=0,this.stateCenter.datiTimeWindow=0,this.stateCenter.bigimTimeWindow=0},t.prototype.resetRoom=function(){var t=this;if(this.logger.debug("zb.rh.rr call"),this.resetTryLogin(),this.resetRoomCallBack(),this.stateCenter.streamList=[],this.stateCenter.streamQuerying=!1,this.stateCenter.publishStreamList={},this.stateCenter.publishSeq=[],this.stateCenter.playSeq=[],this.stateCenter.joinLiveCallbackMap={},this.stateCenter.joinLiveRequestMap={},this.stateCenter.streamUrlMap={},this.resetBigRoomInfo(),this.logger.debug("zb.rh.rr call send logout=",this.stateCenter.sessionid),"0"!==this.stateCenter.sessionid){var e={room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid,room_user_session_id:this.stateCenter.roomSessionId}};this.socketCenter.registerRouter("leaveRoom",function(e){t.handleLogoutRsp(e)}),this.socketCenter.sendMessage("zegochat_js.room_quit_req",e)}this.stateCenter.roomSid="0",this.stateCenter.roomSessionId="0",this.setRunState(s.ENUM_RUN_STATE.logout),this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.userid,this.stateCenter.idName,this.stateCenter.sessionid,s.PROTO_VERSION,this.stateCenter.deviceId),this.logger.debug("zb.rh.rr call success")},t.prototype.resetRoomCallBack=function(){},t.prototype.onDisconnect=function(t){},t.prototype.loginSuccessCallBack=function(t,e){},t.prototype.onGetTotalUserList=function(t,e){},t.prototype.login=function(t,e,r,i){this.logger.setSessionInfo(this.stateCenter.appid,t,"",this.stateCenter.idName,"",s.PROTO_VERSION,this.stateCenter.deviceId),this.logger.info("zb.rh.lg call:",t),this.stateCenter.isLogin()?(this.stateCenter.runState!==s.ENUM_RUN_STATE.logout&&(this.logger.debug("zb.rh.lg reset"),this.setRunState(s.ENUM_RUN_STATE.logout),this.resetRoom()),this.logger.debug("zb.rh.lg begin"),this.setRunState(s.ENUM_RUN_STATE.trylogin),this.stateCenter.roomid=t,this.stateCenter.role=e,o.ClientUtil.registerCallback("enterRoom",{success:r,error:i},this.stateCenter.callbackList),this.resetTryLogin(),this.tryLogin(),this.logger.info("zb.rh.lg call success")):i({code:"",msg:"no login hall before entering room"})},t.prototype.getRoomInfo=function(t){var e=this;if(this.stateCenter.runState===s.ENUM_RUN_STATE.login){o.ClientUtil.registerCallback("getRoomInfo",{success:t,error:t},this.stateCenter.callbackList),this.socketCenter.registerRouter("zegochat_js.room_info_rsp",function(t){e.handleRoomInfoRsp(t)});var r={room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid||"0",room_user_session_id:this.stateCenter.roomSessionId||"0"}};this.socketCenter.sendMessage("zegochat_js.room_info_req",r)}else this.logger.error("zn.rh.gri no enter room")},t.prototype.loginBodyData=function(){return null},t.prototype.tryLogin=function(){var t=this;if(this.logger.debug("zb.rh.tl call"),this.stateCenter.runState===s.ENUM_RUN_STATE.trylogin){if(++this.stateCenter.tryLoginCount>s.MAX_TRY_LOGIN_COUNT){this.logger.error("zb.rh.tl fail times limit");var e=this.stateCenter.lastRunState;return this.setRunState(s.ENUM_RUN_STATE.logout),this.resetRoom(),void(e==s.ENUM_RUN_STATE.login?(this.logger.error("zb.rh.tl fail and disconnect"),this.onDisconnect(s.sdkErrorList.LOGIN_DISCONNECT)):(this.logger.info("zb.rh.tl fail and callback user"),o.ClientUtil.actionErrorCallback("enterRoom",this.stateCenter.callbackList)(s.sdkErrorList.LOGIN_TIMEOUT)))}this.stateCenter.startConnceTime=(new Date).getTime(),console.warn("start enterRoom",this.stateCenter.startConnceTime),this.socketCenter.registerRouter("enterRoom",function(e,r){t.handleLoginRsp(e,r)});var r=this.loginBodyData();this.logger.info("zb.rh.tl use current websocket and sent login"),this.socketCenter.sendMessage("zegochat_js.room_enter_req",r),this.stateCenter.tryLoginTimer=setTimeout(function(){t.tryLogin()},s.TRY_LOGIN_INTERVAL[this.stateCenter.tryLoginCount%s.MAX_TRY_LOGIN_COUNT]),this.logger.info("zb.rh.tl call success")}else this.logger.error("zb.rh.tl state error")},t.prototype.handleRoomInfoRsp=function(t){if(this.logger.debug("zb.rh.hrir call"),this.stateCenter.runState===s.ENUM_RUN_STATE.login)return t.body.code&&0!==t.body.code?(this.logger.error("zb.rh.hrir server error=",t.body.code+" "+t.body.message),void o.ClientUtil.actionErrorCallback("getRoomInfo",this.stateCenter.callbackList)({code:t.body.code,msg:t.body.message})):(o.ClientUtil.actionSuccessCallback("getRoomInfo",this.stateCenter.callbackList)(null,t.body.streams_info),void this.logger.info("zb.rh.hrir call success"));this.logger.error("zb.rh.hrir state error")},t.prototype.handleLoginRsp=function(t,e){if(this.logger.debug("zb.rh.hlr call"),this.stateCenter.runState===s.ENUM_RUN_STATE.trylogin){if(t.header.seq===e)return t.body.code&&0!==t.body.code?(this.handleLoginFail(t),void this.logger.error("zb.rh.hlr server error=",t.body.code+" "+t.body.message)):(this.handleLoginSuccess(t),void this.logger.info("zb.rh.hlr call success."));this.logger.error("zb.rh.hlr in wrong seq, local=",e,",recv=",t.header.seq)}else this.logger.error("zb.rh.hlr state error")},t.prototype.handleLoginFail=function(t){if(this.logger.debug("zb.rh.hlf call"),o.ClientUtil.isKeepTryLogin(t.body.code))this.logger.warn("zb.rh.hlf KeepTry true");else{var e=this.stateCenter.lastRunState;this.setRunState(s.ENUM_RUN_STATE.logout),this.resetRoom(),e===s.ENUM_RUN_STATE.login?(this.logger.info("zb.rh.hlf callback disconnect"),this.onDisconnect(t.body.code)):(this.logger.info("zb.rh.hlf callback error"),o.ClientUtil.actionErrorCallback("enterRoom",this.stateCenter.callbackList)({code:t.body.code,msg:t.body.message})),this.logger.debug("zb.rh.hlf call success")}},t.prototype.handleLoginSuccess=function(t){this.stateCenter.startloginSucTime=(new Date).getTime(),console.warn("enterRoom suc",this.stateCenter.startloginSucTime,this.stateCenter.startloginSucTime-this.stateCenter.startloginTime,this.stateCenter.startloginSucTime-this.stateCenter.startConnceTime),this.logger.info("zb.rh.hls call");var e=this.stateCenter.lastRunState;this.setRunState(s.ENUM_RUN_STATE.login),this.stateCenter.timeStamp=t.header.timeStamp,this.stateCenter.roomSid=t.body.room_header.room_sid,this.stateCenter.roomSessionId=t.body.room_header.room_user_session_id,this.stateCenter.userSeq=t.body.userlist_seq,this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.userid,this.stateCenter.idName,this.stateCenter.sessionid,s.PROTO_VERSION,this.stateCenter.deviceId),this.resetTryLogin(),this.loginSuccessCallBack(e,t)},t.prototype.logout=function(){return this.logger.debug("zb.rh.lo call"),this.stateCenter.runState===s.ENUM_RUN_STATE.logout?(this.logger.warn("zb.rh.lo at logout"),!1):(this.resetRoom(),this.logger.info("zb.rh.lo call success"),!0)},t.prototype.setUserStateUpdate=function(t){return this.logger.debug("zb.rh.su call"),"boolean"!=typeof t?(this.logger.info("zb.rh.su param error"),!1):(this.stateCenter.userStateUpdate=t,this.logger.info("zb.rh.su call success "+t),!0)},t.prototype.fetchUserList=function(){this.logger.debug("zb.rh.ful call"),this.stateCenter.userQuerying?this.logger.warn("zb.rh.ful is already querying"):(this.stateCenter.userQuerying=!0,this.stateCenter.userTempList=[],this.fetchUserListWithPage(0),this.logger.info("zb.rh.ful the first time call"))},t.prototype.fetchUserListWithPage=function(t){var e=this;this.logger.debug("zb.rh.fulwp call"),this.socketCenter.registerRouter("zegochat_js.room_userlist_rsp",function(t){e.handleFetchUserListRsp(t)}),this.socketCenter.sendMessage("zegochat_js.room_userlist_req",{room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid,room_user_session_id:this.stateCenter.roomSessionId},mark:"0"}),this.logger.info("zb.rh.fulwp call success")},t.prototype.handleFetchUserListRsp=function(t){if(this.logger.debug("zb.rh.hfulr call"),t.body.code&&0!==t.body.code)return this.stateCenter.userQuerying=!1,void this.logger.info("zb.rh.hfulr fetch error "+t.body.code+" "+t.body.message);if(this.stateCenter.userStateUpdate){this.stateCenter.userTempList=this.stateCenter.userTempList.concat(t.body.users),this.stateCenter.userSeq=t.body.userlist_seq,this.logger.info("zb.rh.hfulr set user Seq "+this.stateCenter.userSeq);for(var e=[],r=0;r<this.stateCenter.userTempList.length;r++){var s={idName:this.stateCenter.userTempList[r].user_id,nickName:this.stateCenter.userTempList[r].user_name,role:this.stateCenter.userTempList[r].role};e.push(s)}this.stateCenter.userQuerying=!1,this.onGetTotalUserList(this.stateCenter.roomid,e),this.stateCenter.userTempList=[],this.logger.info("zb.rh.hfulr call success user_list "+e+" count "+e.length)}},t.prototype.handleLogoutRsp=function(t){this.logger.debug("zb.rh.hlor result=",t.body.code)},t.prototype.handlePushUserStateUpdateMsg=function(t){if(this.logger.info("zb.rh.hpus call"),this.stateCenter.isLogin())if(this.stateCenter.userStateUpdate){if(this.stateCenter.userSeq+t.body.user_actions.length!==t.body.user_list_seq)return this.logger.warn("zb.rh.hpus fetch new userlist "+this.stateCenter.userSeq,NaN+t.body.user_list_seq),void this.fetchUserList();this.stateCenter.userSeq=t.body.user_list_seq,this.logger.debug("zb.rh.hpus push userSeq "+this.stateCenter.userSeq);for(var e=[],r=0;r<t.body.user_actions.length;r++){var s={action:t.body.user_actions[r].action,idName:t.body.user_actions[r].user_id,nickName:t.body.user_actions[r].user_name,role:t.body.user_actions[r].role,loginTime:t.body.user_actions[r].login_time};e.push(s)}this.onUserStateUpdate(t.body.room_pushheader.room_id,e),this.logger.info("zb.rh.hpus call success")}else this.logger.error("zb.rh.hpus no userStateUpdate flag");else this.logger.error("zb.rh.hpus not login")},t.prototype.onUserStateUpdate=function(t,e){},t}();e.RoomHandler=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),o=r(1),i=function(){function t(t,e,r){this.logger=t,this.socketCenter=r,this.stateCenter=e}return t.prototype.onStreamUpdated=function(t,e){},t.prototype.onStreamExtraInfoUpdated=function(t){},t.prototype.handleStreamStart=function(t,e){var r=this;if(this.stateCenter.streamQuerying=!1,this.socketCenter.registerRouter("zegochat_js.push_room_stream_update_req",function(t){r.handlePushStreamUpdateMsg(t)}),t==s.ENUM_RUN_STATE.login)this.logger.info("zb.sh.hss recover from disconnect so call streamupdate"),this.handleFullUpdateStream(e.body.stream_seq,e.body.streams_info||[]);else{this.logger.info("zb.sh.hss success callback user"),this.stateCenter.streamList=e.body.streams_info||[],this.stateCenter.streamSeq=e.body.stream_seq;for(var i=0;i<this.stateCenter.streamList.length;i++)this.stateCenter.streamList[i].user_id==this.stateCenter.idName&&(this.updateStreamDeleted(this.stateCenter.streamList[i].stream_id),this.stateCenter.streamList.splice(i,1));var n=this.makeCallbackStreamList(this.stateCenter.streamList);o.ClientUtil.actionSuccessCallback("enterRoom",this.stateCenter.callbackList)(n)}},t.prototype.onPublishStateUpdate=function(t,e,r){},t.prototype.updateStreamInfo=function(t,e,r){var s=this;void 0===e&&(e=""),this.logger.debug("zb.sh.usi call");var o="",i=null;if(this.stateCenter.streamList.forEach(function(e,r){e.stream_id===t&&(i=r)}),this.stateCenter.publishStreamList[t])o=this.stateCenter.publishStreamList[t].sid;else{if(!i)return void this.logger.error("zb.sh.usi stream is not exist");o=this.stateCenter.streamList[i].stream_sid}var n={room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid||"0",room_user_session_id:this.stateCenter.roomSessionId||"0"},stream_id:t,stream_sid:o,extra_info:e,title:""};this.socketCenter.registerRouter("zegochat_js.room_stream_update_rsp",function(t){s.handleStreamUpdateRsp(t)}),this.socketCenter.sendMessage("zegochat_js.room_stream_update_req",n,void 0,r),this.logger.info("zb.sh.usi call success ")},t.prototype.handleStreamUpdateRsp=function(t){if(this.stateCenter.isLogin())if(t.body.code&&0!==t.body.code)this.logger.error("zb.sh.hsur stream update error "+t.body.code+" "+t.body.message);else{this.logger.info("zb.sh.hsur stream seq "+this.stateCenter.streamSeq+" server seq "+t.body.stream_seq),this.stateCenter.streamSeq++;for(var e=0;e<t.body.stream_info.length;e++){var r=t.body.stream_info[e].stream_id;if(!this.stateCenter.publishStreamList[r])return void this.logger.info("hsur.0 stream is not exist");this.stateCenter.publishStreamList[r].state==s.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[r].state=s.ENUM_PUBLISH_STREAM_STATE.publishing,this.onPublishStateUpdate(0,r,0))}}else this.logger.error("zb.sh.hsur not login")},t.prototype.handleFetchStreamListRsp=function(t){this.logger.info("zb.sh.hfslr call"),this.stateCenter.streamQuerying=!1,0===t.body.code?this.stateCenter.streamSeq!==t.body.stream_seq?(this.handleFullUpdateStream(t.body.stream_seq,t.body.stream_info),this.logger.debug("zb.sh.hfslr call success")):this.logger.info("zb.sh.hfslr same seq"):this.logger.info("zb.sh.hfslr server error=",t.body.code)},t.prototype.handleFullUpdateStream=function(t,e){var r=this;this.logger.debug("zb.sh.hfus call"),this.stateCenter.streamSeq=t,this.logger.debug("zb.sh.hfus server seq "+this.stateCenter.streamSeq),o.ClientUtil.mergeStreamList(this.logger,this.stateCenter.idName,this.stateCenter.streamList,e,function(t,e,o){0!==t.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(s.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(t))),0!==e.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(s.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(e))),0!==o.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.makeCallbackStreamList(o)))}),this.logger.info("zb.sh.hfus call success")},t.prototype.handlePushStreamUpdateMsg=function(t){if(this.logger.info("zb.sh.hpsum call"),t.body.streams_info&&0!==t.body.streams_info.length){if(t.body.streams_info.length+this.stateCenter.streamSeq!==t.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.stateCenter.streamSeq=t.body.stream_seq,t.body.stream_cmd+12e3){case s.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(t.body.streams_info);break;case s.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(t.body.streams_info);break;case s.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(t.body.streams_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},t.prototype.handleAddedStreamList=function(t){this.logger.debug("zb.sh.hasl call");for(var e,r=[],o=0;o<t.length;o++)if(t[o].anchor_id_name!=this.stateCenter.idName){e=!1;for(var i=0;i<this.stateCenter.streamList.length;i++)if(t[o].stream_id===this.stateCenter.streamList[i].stream_id){e=!0;break}e||r.push(t[o])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var n=0;n<r.length;n++)this.stateCenter.streamList.push(r[n]);this.onStreamUpdated(s.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},t.prototype.handleDeletedStreamList=function(t){this.logger.debug("zb.sh.hdsl call");for(var e=[],r=0;r<t.length;r++)if(t[r].anchor_id_name!=this.stateCenter.idName){for(var o=this.stateCenter.streamList.length-1;o>=0;o--)if(t[r].stream_id===this.stateCenter.streamList[o].stream_id){this.stateCenter.streamList.splice(o,1),e.push(t[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==e.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(s.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(e))),this.logger.info("zb.sh.hdsl call")},t.prototype.handleUpdatedStreamList=function(t){this.logger.debug("zb.sh.husl call");for(var e=[],r=0;r<t.length;r++)if(t[r].anchor_id_name!=this.stateCenter.idName){for(var s=0;s<this.stateCenter.streamList.length;s++)if(t[r].stream_id===this.stateCenter.streamList[s].stream_id){t[r].extra_info!==this.stateCenter.streamList[s].extra_info&&(this.stateCenter.streamList[s]=t[r],e.push(t[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==e.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.makeCallbackStreamList(e))),this.logger.info("zb.sh.husl call success")},t.prototype.fetchStreamList=function(){if(this.logger.info("zb.sh.fsl call"),this.stateCenter.isLogin())this.logger.info("zb.sh.fsl state error");else if(this.stateCenter.streamQuerying)this.logger.info("zb.sh.fsl already doing");else{this.stateCenter.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request");this.socketCenter.registerRouter("stream_info",this.handleFetchStreamListRsp),this.socketCenter.sendMessage("stream_info",{reserve:0}),this.logger.debug("zb.sh.fsl call success")}},t.prototype.makeCallbackStreamList=function(t){var e=[];if(t&&t.length>0)for(var r=0;r<t.length;r++){var s={user_id:t[r].user_id,user_name:t[r].user_name,stream_id:t[r].stream_id,stream_sid:t[r].stream_sid,extra_info:t[r].extra_info,title:t[r].title,stream_ver:t[r].stream_ver};e.push(s)}return e},t.prototype.updateStreamExtraInfo=function(t,e){return this.logger.info("zb.sh.usei call"),t?"string"==typeof e&&(this.stateCenter.publishStreamList[t]&&(this.stateCenter.publishStreamList[t].extra_info=e,this.stateCenter.publishStreamList[t].state>=s.ENUM_PUBLISH_STREAM_STATE.update_info&&this.updateStreamInfo(t,e)),!0):(this.logger.error("zb.sh.usei param error"),!1)},t.prototype.updateStreamCreated=function(t,e,r){var s=this;if(this.logger.info("zb.sh.usc call"),t){var o={room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid||"0",room_user_session_id:this.stateCenter.roomSessionId||"0"},stream_id:t,extra_info:e,title:""};this.socketCenter.registerRouter("zegochat_js.room_stream_create_rsp",function(t){s.handleStreamCreatedRsp(t)}),setTimeout(function(){s.socketCenter.sendMessage("zegochat_js.room_stream_create_req",o,void 0,r)},100)}else this.logger.error("zb.sh.usc streamid error")},t.prototype.handleStreamCreatedRsp=function(t){if(this.stateCenter.isLogin())if(t.body.code&&0!==t.body.code)this.logger.error("zb.sh.hsur stream update error "+t.body.code+" "+t.body.message);else{this.logger.info("zb.sh.hsur stream seq "+this.stateCenter.streamSeq+" server seq "+t.body.stream_seq),this.stateCenter.streamSeq=t.body.stream_seq;var e=t.body.stream_id;this.stateCenter.publishStreamList[e]?this.stateCenter.publishStreamList[e].state==s.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[e].state=s.ENUM_PUBLISH_STREAM_STATE.publishing,this.stateCenter.publishStreamList[e].sid=t.body.stream_sid,this.stateCenter.publishStreamList[e].ver=t.body.stream_ver,this.onPublishStateUpdate(0,e,0)):this.logger.info("hsur.0 stream is not exist")}else this.logger.error("zb.sh.hsur not login")},t.prototype.updateStreamDeleted=function(t,e){var r=this;if(this.logger.info("zb.sh.usd call"),t){var s={room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid||"0",room_user_session_id:this.stateCenter.roomSessionId||"0"},stream_id:t,stream_sid:this.stateCenter.publishStreamList[t].sid};this.socketCenter.registerRouter("zegochat_js.room_stream_delete_rsp",function(t){r.handleStreamDeletedRsp(t)}),this.socketCenter.sendMessage("zegochat_js.room_stream_delete_req",s,void 0,e)}else this.logger.error("zb.sh.usd streamid error")},t.prototype.handleStreamDeletedRsp=function(t){this.stateCenter.isLogin()?t.body.code&&0!==t.body.code?this.logger.error("zb.sh.hsur stream update error "+t.body.code+" "+t.body.message):(this.logger.info("zb.sh.hsur stream seq "+this.stateCenter.streamSeq+" server seq "+t.body.stream_seq),this.stateCenter.streamSeq=t.body.stream_seq,delete this.stateCenter.publishStreamList[t.body.stream_id]):this.logger.error("zb.sh.hsur not login")},t}();e.StreamHandler=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),o=r(1),i=function(){function t(t,e,r){this.logger=t,this.socketCenter=r,this.stateCenter=e}return t.prototype.resetHeartbeat=function(){this.logger.debug("zb.hb.rht call"),clearTimeout(this.stateCenter.heartbeatTimer),this.stateCenter.heartbeatTimer=null,this.stateCenter.tryHeartbeatCount=0,this.logger.debug("zb.hb.rht call success")},t.prototype.hbLogout=function(t){},t.prototype.start=function(t){var e=this;if(this.logger.debug("zb.hb.sht call"),this.stateCenter.isLogin()){if(++this.stateCenter.tryHeartbeatCount>3)return this.logger.error("zb.hb.sht come to try limit"),void this.hbLogout(s.sdkErrorList.HEARTBEAT_TIMEOUT);this.logger.debug("zb.hb.sht send packet");this.socketCenter.registerRouter("zegochat_js.user_hb_rsp",function(t){e.handleHeartbeatRsp(t)}),this.socketCenter.sendMessage("zegochat_js.user_hb_req",{reserve:0}),this.logger.debug("zb.hb.sht call success"),this.stateCenter.heartbeatInterval=t,this.stateCenter.heartbeatTimer=setTimeout(function(){e.start(e.stateCenter.heartbeatInterval)},this.stateCenter.heartbeatInterval)}else this.logger.error("zb.hb.sht state error")},t.prototype.handleHeartbeatRsp=function(t){if(this.logger.debug("zb.hb.hhbr call"),t.body.code&&0!==t.body.code)return this.logger.error("zb.hb.hhbr call disconnect, server error=",t.body.code+" "+t.body.message),void this.hbLogout(o.ClientUtil.getServerError(t.body.code));this.stateCenter.tryHeartbeatCount=0,this.stateCenter.heartbeatInterval=t.body.hb_interval,this.stateCenter.heartbeatInterval<s.MINIUM_HEARTBEAT_INTERVAL&&(this.stateCenter.heartbeatInterval=s.MINIUM_HEARTBEAT_INTERVAL),this.stateCenter.sessionid=t.header.session_id,this.stateCenter.timeStamp=t.header.timestamp,this.stateCenter.userid=t.header.user_uid,this.logger.debug("zb.hb.hhbr call success")},t}();e.HeartBeatHandler=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),o=r(1),i=function(){function t(t,e,r){this.logger=t,this.socketCenter=r,this.stateCenter=e}return t.prototype.sendCustomCommand=function(t,e,r,s){var i=this;if(this.logger.debug("zb.mh.scc call"),!this.stateCenter.isLogin())return this.logger.error("zb.mh.scc state error"),!1;if(!t||0==t.length)return this.logger.error("zb.mh.scc dstMembers error"),!1;"object"==typeof e&&(e=JSON.stringify(e));var n={room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid||"0",room_user_session_id:this.stateCenter.roomSessionId||"0"},request_id:this.stateCenter.getRequestId(),msg:e,destids:t};return o.ClientUtil.checkCustomCommandParam(n)?(this.socketCenter.registerRouter("zegochat_js.room_custommsg_rsp",function(t){i.handleSendCustomMsgRsp(t)}),this.socketCenter.sendCustomMessage("zegochat_js.room_custommsg_req",n,r,s),this.logger.info("zb.mh.scc call success"),!0):(this.logger.info("zb.mh.scc param error"),!1)},t.prototype.handleSendCustomMsgRsp=function(t){this.logger.debug("zb.mh.hscmrcall");var e,r=this.stateCenter.sendDataMap[t.header.seq];null!=r?("zegochat_js.room_custommsg_req"!=(e=r._data).data.header.cmd?this.logger.error("zb.mh.hscmrcmd wrong"+e.data.header.cmd):t.body.code&&0!==t.body.code?e.error&&e.error(t.body.msg,t.header.seq,e.data.body.msg):e.success&&e.success(t.header.seq,e.data.body.msg),delete this.stateCenter.sendDataMap[t.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error("zb.mh.hscmrno found seq="+t.header.seq),this.logger.debug("zb.mh.hscmr  call success")},t.prototype.handlePushCustomMsg=function(t){this.logger.debug("zb.mh.hpcm submsg=",t.body.msg),this.onRecvCustomCommand(t.body.from_user_id,t.body.from_user_name,t.body.msg)},t.prototype.onRecvCustomCommand=function(t,e,r){},t.prototype.sendRoomMsg=function(t,e,r,o,i){var n=this;if(this.logger.debug("zb.mh.srm call"),this.stateCenter.isLogin()){var a=Date.parse(new Date+"");if(this.stateCenter.sendRoomMsgTime>0&&this.stateCenter.sendRoomMsgTime+this.stateCenter.SendRoomMsgInterval>a)return this.logger.info("zb.mh.srm freq error"),void(i&&i(s.sdkErrorList.FREQ_LIMITED,0,t,e,r));this.stateCenter.sendRoomMsgTime=a,this.logger.debug("zb.mh.srm send fetch request");var h={room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid||"0",room_user_session_id:this.stateCenter.roomSessionId||"0"},msg_category:t,msg_type:e,msg_priority:1,msg_content:r,destids:[]};this.socketCenter.registerRouter("zegochat_js.room_immsg_rsp",function(t){n.handleSendRoomMsgRsp(t)}),this.socketCenter.sendCustomMessage("zegochat_js.room_immsg_req",h,o,i),this.logger.info("zb.mh.srm call success")}else this.logger.error("zb.mh.srm no enter room")},t.prototype.handleSendRoomMsgRsp=function(t){this.logger.debug("zb.mh.hsrmr call");var e,r=this.stateCenter.sendDataMap[t.header.seq];null!=r?("zegochat_js.room_immsg_req"!==(e=r._data).data.header.cmd?this.logger.error("zb.mh.hsrmr cmd wrong "+e.data.header.cmd):t.body.code&&0!==t.body.code?e.error&&e.error({code:t.body.code,msg:t.body.message},t.header.seq,t.body.msg_id):e.success&&e.success(t.header.seq,t.body.msg_id),delete this.stateCenter.sendDataMap[t.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error("hzb.mh.hsrmr no found seq="+t.header.seq),this.logger.info("zb.mh.hsrmr call success")},t.prototype.onRecvRoomMsg=function(t,e,r){},t.prototype.getRoomChatInfo=function(t,e,r,s,o){var i=this;if(this.logger.debug("zb.mh.grc call"),this.stateCenter.isLogin()){var n={room_header:{room_id:this.stateCenter.roomid,room_sid:this.stateCenter.roomSid||"0",room_user_session_id:this.stateCenter.roomSessionId||"0"},request_id:this.stateCenter.getRequestId(),msg_priority:1,msg_id:t,sort_type:e,msg_count:r};this.socketCenter.registerRouter("zegochat_js.room_immsg_get_rsp",function(t){i.handleRoomChatInfoRsp(t)}),this.socketCenter.sendCustomMessage("zegochat_js.room_immsg_get_req",n,s,o),this.logger.info("zb.mh.grc call success")}else this.logger.error("zb.mh.srm no enter room")},t.prototype.handleRoomChatInfoRsp=function(t){this.logger.debug("zb.mh.hrcr call");var e,r=this.stateCenter.sendDataMap[t.room_header.seq];null!=r?("zegochat_js.room_immsg_get_req"!=(e=r._data).data.header.cmd?this.logger.error("zb.mh.hrcr cmd wrong"+e.data.header.cmd):t.body.code&&0!==t.body.code?e.error&&e.error(o.ClientUtil.getServerError(t.body.code),t.header.seq,t.body.msg_id):e.success&&e.success(t.room_header.seq,t.body.server_msg_id,t.body.ret_msg_id,t.body.msg_data),delete this.stateCenter.sendDataMap[t.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error("hzb.mh.hrcr no found seq="+t.header.seq),this.logger.info("zb.mh.hrcr call success")},t}();e.MessageHandler=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),o=r(1),i=function(){function t(t,e,r){this.logger=t,this.socketCenter=r,this.stateCenter=e}return t.prototype.setHallState=function(t){this.logger.debug("zb.hh.srs old="+this.stateCenter.hallState+", new="+t),this.stateCenter.lastHallState=this.stateCenter.hallState,this.stateCenter.hallState=t},t.prototype.resetHallTryLogin=function(){this.logger.debug("zb.hh.rtl call"),clearTimeout(this.stateCenter.tryHallLoginTimer),this.stateCenter.tryHallLoginTimer=null,this.stateCenter.tryHallLoginCount=0,this.logger.debug("zb.hh.rtl call success")},t.prototype.resetHall=function(){var t=this;if(this.logger.debug("zb.hh.rh call"),this.resetHallTryLogin(),this.resetHallCallBack(),this.stateCenter.cmdCallback={},this.logger.debug("zb.hh.rh call send logout=",this.stateCenter.sessionid),"0"!==this.stateCenter.sessionid){var e={user_id:this.stateCenter.idName||0};this.socketCenter.registerRouter("hallLogout",function(e){t.handleLogoutRsp(e)}),this.socketCenter.sendMessage("zegochat_js.user_logout_req",e)}this.socketCenter.closeSocket(),this.setHallState(s.ENUM_RUN_STATE.logout),this.stateCenter.userid="0",this.stateCenter.sessionid="0",this.logger.setSessionInfo(this.stateCenter.appid,"",this.stateCenter.userid,"",this.stateCenter.sessionid,s.PROTO_VERSION,this.stateCenter.deviceId),this.logger.debug("zb.hh.rh call success")},t.prototype.resetHallCallBack=function(){},t.prototype.onDisconnect=function(t){},t.prototype.onTempBroken=function(){},t.prototype.onReconnect=function(){},t.prototype.loginSuccessCallBack=function(t,e){},t.prototype.dispatchConnecnt=function(){var t=this;this.logger.info("zc.hh.dc call");var e=this.dispatchBodyData(),r=this.stateCenter.dispatchServer;if(XMLHttpRequest){var s=new XMLHttpRequest;s.open("POST",r),s.setRequestHeader("Content-type","application/json; charset=utf-8"),s.onreadystatechange=function(){if(200==s.status&&4==s.readyState&&s.responseText&&""!==s.responseText){var e=JSON.parse(s.responseText);e.server_addrs&&0!==e.server_addrs.length&&(t.stateCenter.server=e.server_addrs[0],t.stateCenter.sessionExpire=e.session_expire+"",t.resetHallTryLogin(),t.tryHallLogin(),t.logger.info("zb.hh.lg call success"))}},s.send(JSON.stringify(e))}else wx.request({url:r,header:{"Content-Type":"application/json"},method:"POST",data:JSON.stringify(e),dataType:"json",success:function(e){e.data.server_addrs&&0!==e.data.server_addrs.length&&(t.stateCenter.server=e.data.server_addrs[0],t.stateCenter.sessionExpire=e.data.session_expire+"",t.resetHallTryLogin(),t.tryHallLogin(),t.logger.info("zb.hh.lg call success"))},fail:function(t){console.log("send failed "+t.statusCode)}})},t.prototype.login=function(t,e,r){if(this.logger.info("zb.hh.lg call:",t),!this.stateCenter.configOK)return this.logger.error("zb.hh.lg param error"),void r({code:"",msg:"config error"});this.stateCenter.hallState!==s.ENUM_RUN_STATE.logout&&(this.logger.debug("zb.hh.lg reset"),this.setHallState(s.ENUM_RUN_STATE.logout),this.resetHall()),this.logger.debug("zb.hh.lg begin"),this.setHallState(s.ENUM_RUN_STATE.trylogin),this.stateCenter.token=t,o.ClientUtil.registerCallback("hallLogin",{success:e,error:r},this.stateCenter.callbackList),this.dispatchConnecnt()},t.prototype.loginBodyData=function(){return null},t.prototype.dispatchBodyData=function(){return null},t.prototype.tryHallLogin=function(){var t=this;if(this.logger.debug("zb.hh.tl call"),this.stateCenter.hallState===s.ENUM_RUN_STATE.trylogin){if(++this.stateCenter.tryHallLoginCount>s.MAX_TRY_LOGIN_COUNT){this.logger.error("zb.hh.tl fail times limit");var e=this.stateCenter.lastHallState;return this.setHallState(s.ENUM_RUN_STATE.logout),this.resetHall(),void(e==s.ENUM_RUN_STATE.login?(this.logger.error("zb.hh.tl fail and disconnect"),this.onDisconnect(s.sdkErrorList.LOGIN_DISCONNECT)):(this.logger.info("zb.hh.tl fail and callback user"),o.ClientUtil.actionErrorCallback("hallLogin",this.stateCenter.callbackList)(s.sdkErrorList.LOGIN_TIMEOUT)))}if(this.stateCenter.startConnceTime=(new Date).getTime(),console.warn("start connect",this.stateCenter.startConnceTime),this.socketCenter.isDisConnect()){this.logger.debug("zb.hh.tl need new websocket");try{this.socketCenter.closeSocket(),this.logger.debug("zb.hh.tl new websocket"),this.socketCenter.createSocket(this.stateCenter.server),this.socketCenter.registerRouter("hallLogin",function(e,r){t.handleLoginRsp(e,r)}),this.socketCenter.closeHandler(function(e){t.socketCenter.closeSocket(),t.closeHandler(e)}),this.socketCenter.openHandler(function(){t.openHandler()})}catch(t){this.logger.error("zb.hh.tl websocket err:"+t)}}else{var r=this.loginBodyData();this.logger.info("zb.hh.tl use current websocket and sent login"),this.socketCenter.sendMessage("zegochat_js.user_login_ws_req",r)}this.stateCenter.tryHallLoginTimer=setTimeout(function(){t.tryHallLogin()},s.TRY_LOGIN_INTERVAL[this.stateCenter.tryHallLoginCount%s.MAX_TRY_LOGIN_COUNT]),this.logger.info("zb.hh.tl call success")}else this.logger.error("zb.hh.tl state error")},t.prototype.handleLoginRsp=function(t,e){if(this.logger.debug("zb.hh.hlr call"),this.stateCenter.hallState===s.ENUM_RUN_STATE.trylogin){if(t.header.seq===e)return t.body.code&&0!==t.body.code?(this.handleLoginFail(t),void this.logger.error("zb.hh.hlr server error=",t.body.code+" "+t.body.message)):(this.handleLoginSuccess(t),void this.logger.info("zb.hh.hlr call success."));this.logger.error("zb.hh.hlr in wrong seq, local=",e,",recv=",t.header.seq)}else this.logger.error("zb.hh.hlr state error")},t.prototype.handleLoginFail=function(t){if(this.logger.debug("zb.hh.hlf call"),o.ClientUtil.isKeepTryLogin(t.body.code))this.logger.warn("zb.hh.hlf KeepTry true");else{var e=this.stateCenter.lastHallState;this.setHallState(s.ENUM_RUN_STATE.logout),this.resetHall(),e===s.ENUM_RUN_STATE.login?(this.logger.info("zb.hh.hlf callback disconnect"),this.onDisconnect(t.body.code)):(this.logger.info("zb.hh.hlf callback error"),o.ClientUtil.actionErrorCallback("hallLogin",this.stateCenter.callbackList)({code:t.body.code,msg:t.body.message})),this.logger.debug("zb.hh.hlf call success")}},t.prototype.handleLoginSuccess=function(t){this.stateCenter.startloginSucTime=(new Date).getTime(),console.warn("login suc",this.stateCenter.startloginSucTime,this.stateCenter.startloginSucTime-this.stateCenter.startloginTime,this.stateCenter.startloginSucTime-this.stateCenter.startConnceTime),this.logger.info("zb.hh.hls call");var e=this.stateCenter.lastHallState;this.setHallState(s.ENUM_RUN_STATE.login),this.stateCenter.userid=t.body.user_uid,this.stateCenter.sessionid=t.body.session_id,this.stateCenter.timeStamp=t.header.timestamp,this.stateCenter.heartbeatTimeOut=t.body.hb_timeout,this.logger.setSessionInfo(this.stateCenter.appid,"",this.stateCenter.userid,"",this.stateCenter.sessionid,s.PROTO_VERSION,this.stateCenter.deviceId),t.body.log_sever_addr&&""!=t.body.log_sever_addr&&this.logger.openLogServer(t.body.log_sever_addr),this.resetHallTryLogin(),this.loginSuccessCallBack(e,t),this.stateCenter.isHallReconnect?(this.onReconnect(),this.stateCenter.isHallReconnect=!1):o.ClientUtil.actionSuccessCallback("hallLogin",this.stateCenter.callbackList)()},t.prototype.openHandler=function(){this.logger.info("zb.hh.oh websocket.onpen call"),this.socketCenter.responseHandler();var t=this.loginBodyData();this.logger.info("zb.hh.oh websocket.onpen send login"),this.stateCenter.startloginTime=(new Date).getTime(),console.warn("start login",this.stateCenter.startloginTime,this.stateCenter.startloginTime-this.stateCenter.startConnceTime),this.socketCenter.sendMessage("zegochat_js.user_login_ws_req",t),this.logger.debug("zb.hh.oh websocket.onpen call success")},t.prototype.closeHandler=function(t){this.logger.info("zb.hh.ws.oc msg="+JSON.stringify(t)),this.stateCenter.hallState!==s.ENUM_RUN_STATE.logout?this.stateCenter.hallState===s.ENUM_RUN_STATE.trylogin&&this.stateCenter.tryLoginCount<=s.MAX_TRY_LOGIN_COUNT?this.logger.info("zb.hh.ws.oc is called because of try login"):this.stateCenter.hallState===s.ENUM_RUN_STATE.login?(this.logger.info("zb.hh.ws.oc is called because of network broken, try again"),this.setHallState(s.ENUM_RUN_STATE.trylogin),this.resetHallTryLogin(),this.onTempBroken(),this.stateCenter.isHallReconnect=!0,this.tryHallLogin()):(this.logger.error("zb.hh.ws.oc out of think!!!"),this.setHallState(s.ENUM_RUN_STATE.logout),this.resetHall(),this.onDisconnect(s.sdkErrorList.UNKNOWN)):this.logger.info("zb.hh.ws.oc onclose logout flow call websocket.close")},t.prototype.logout=function(){return this.logger.debug("zb.hh.lo call"),this.stateCenter.hallState===s.ENUM_RUN_STATE.logout?(this.logger.warn("zb.hh.lo at logout"),!1):(this.resetHall(),this.logger.info("zb.hh.lo call success"),!0)},t.prototype.handleLogoutRsp=function(t){this.logger.debug("zb.hh.hlor result=",t.body.code)},t}();e.HallHandler=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),o=r(19),i=function(){function t(){this.testEnvironment=!1,this.third_token="",this.pullLimited=!0,this.configOK=!1,this.netType=2,this.roomFlag=1,this.runState=s.ENUM_RUN_STATE.logout,this.lastRunState=s.ENUM_RUN_STATE.logout,this.hallState=s.ENUM_RUN_STATE.logout,this.lastHallState=s.ENUM_RUN_STATE.logout,this.isHallReconnect=!1,this.callbackList={},this.streamList=[],this.publishStreamList={},this.publishSeq=[],this.playSeq=[],this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.sendCommandMap={},this.sendCommandList=new s.LinkedList,this.sendDataMap={},this.sendDataList=new s.LinkedList,this.joinLiveCallbackMap={},this.joinLiveRequestMap={},this.streamUrlMap={},this.cmdCallback={},this.transSeqMap={},this.realyMessageList=[],this.relayTimer=null,this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.bigImMessageList=[],this.tryLoginCount=0,this.tryLoginTimer=null,this.tryHallLoginCount=0,this.tryHallLoginTimer=null,this.heartbeatTimer=null,this.hearbeatTimeOutTimer=null,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.sendDataCheckOnceCount=100,this.sendRoomMsgTime=0,this.SendRoomMsgInterval=500,this.cmdSeq=0,this.audioEffectBuffer={},this.audioBitRate=48e3}return t.prototype.isLogin=function(){return this.hallState===s.ENUM_RUN_STATE.login},t.prototype.getRequestId=function(){return this.idName+"-"+o.getSeq()},t.prototype.getSignalCmdContent=function(t,e,r){var s={request_id:t,room_id:this.roomid,from_userid:this.idName,from_username:this.nickName,to_userid:e};return null!=r&&(s.result=r),JSON.stringify(s)},t}();e.StateCenter=i},function(t,e,r){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.playErrorList={DISPATCH_ERROR:{code:"ZegoPlayWeb.Error.Dispatch",msg:"dispatch request error"},DISPATCH_TIMEOUT:{code:"ZegoPlayWeb.Timeout.Dispatch",msg:"dispatch request timeout"},TOKEN_ERROR:{code:"ZegoPlayWeb.Error.Token",msg:"login token error"},SEND_SESSION_TIMEOUT:{code:"ZegoPlayWeb.Timeout.Session",msg:"send session request timeout"},CREATE_SESSION_ERROR:{code:"ZegoPlayWeb.Error.Session",msg:"create session error"},CREATE_OFFER_ERROR:{code:"ZegoPublish.Error.CreateOffer",msg:"create offer error"},SERVER_MEDIA_DESC_TIMEOUT:{code:"ZegoPlayWeb.Timeout.RemoteOffer",msg:"wating server mediaDesc timeout"},SET_REMOTE_DESC_ERROR:{code:"ZegoPlayWeb.Error.RemoteOffer",msg:"other side offer error"},CREATE_ANSWER_ERROR:{code:"ZegoPlayWeb.Error.CreateAnswer",msg:"create offer error"},SET_LOCAL_DESC_ERROR:{code:"ZegoPlayWeb.Error.LocalDesc",msg:"setLocalDescription error"},SEND_MEDIA_DESC_TIMEOUT:{code:"ZegoPlayWeb.Timeout.Desc",msg:"send mediaDesc timeout"},SEND_CANDIDATE_ERROR:{code:"ZegoPlayWeb.Error.Candidate",msg:"send candidate error"},SEND_CANDIDATE_TIMEOUT:{code:"ZegoPlayWeb.Timeout.Candidate",msg:"send candidate timeout"},SERVER_CANDIDATE_TIMEOUT:{code:"ZegoPlayWeb.Timeout.ServerCandidate",msg:"waiting candidate timeout"},SERVER_CANDIDATE_ERROR:{code:"ZegoPlayWeb.Error.ServerCandidate",msg:"recv candidate error"},MEDIA_CONNECTION_FAILED:{code:"ZegoPlayWeb.Error.ConnectionFailed",msg:"ice Connection state failed"},MEDIA_CONNECTION_CLOSED:{code:"ZegoPlayWeb.Error.ConnectionClosed",msg:"ice connection state closed"},SESSION_CLOSED:{code:"ZegoPlayWeb.Error.SessionClosed",msg:"server session closed"},WEBSOCKET_ERROR:{code:"ZegoPlayWeb.Error.SocketError",msg:"network error"}},e.publishErrorList={DISPATCH_ERROR:{code:"ZegoPublish.Error.Dispatch",msg:"dispatch request error"},DISPATCH_TIMEOUT:{code:"ZegoPublish.Timeout.Dispatch",msg:"dispatch request timeout"},TOKEN_ERROR:{code:"ZegoPublish.Error.Token",msg:"login token error"},SEND_SESSION_TIMEOUT:{code:"ZegoPublish.Timeout.Session",msg:"send session request timeout"},CREATE_SESSION_ERROR:{code:"ZegoPublish.Error.Session",msg:"create session error"},CREATE_OFFER_ERROR:{code:"ZegoPublish.Error.CreateOffer",msg:"create offer error"},SET_LOCAL_DESC_ERROR:{code:"ZegoPublish.Error.LocalDesc",msg:"setLocalDescription error"},SEND_MEDIA_DESC_TIMEOUT:{code:"ZegoPublish.Timeout.Desc",msg:"send mediaDesc timeout"},SERVER_MEDIA_DESC_TIMEOUT:{code:"ZegoPublish.Timeout.ServerAnswer",msg:"waiting server mediaDesc timeout"},SERVER_MEDIA_DESC_ERROR:{code:"ZegoPublish.Error.ServerAnswer",msg:"server mediaDesc type error"},SET_REMOTE_DESC_ERROR:{code:"ZegoPublish.Error.RemoteDesc",msg:"other side offer error"},SEND_CANDIDATE_TIMEOUT:{code:"ZegoPublish.Timeout.Candidate",msg:"sendIceCandidate error"},SERVER_CANDIDATE_TIMEOUT:{code:"ZegoPublish.Timeout.ServerCandidate",msg:"waiting candidate timeout"},SERVER_CANDIDATE_ERROR:{code:"ZegoPublish.Error.ServerCandidate",msg:"recv candidate error"},SESSION_CLOSED:{code:"ZegoPublish.Error.SessionClosed",msg:"server session closed"},MEDIA_CONNECTION_FAILED:{code:"ZegoPublish.Error.IConnectionFailed",msg:"Iice Connection state failed"},MEDIA_CONNECTION_CLOSED:{code:"ZegoPublish.Error.ConnectionClosed",msg:"ice connection state closed"},WEBSOCKET_ERROR:{code:"ZegoPublish.Error.SocketError",msg:"network error"}},e.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},e.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},e.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},e.getSeq=(s=1,function(){return s++})}])});